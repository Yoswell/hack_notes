### HTTP Requests with cURL

**HTTP Requests** are fundamental to web communication, allowing clients to interact with servers. **cURL** is a powerful command-line tool for making HTTP requests, supporting various methods, headers, data formats, and authentication mechanisms.

* **HTTP Methods:** GET, POST, PUT, DELETE, HEAD, OPTIONS, PATCH
* **Request Components:** URL, headers, body, parameters
* **Response Elements:** Status code, headers, body
* **Common Use Cases:** API testing, data submission, file transfer, automation
* **Why cURL is Useful:** Provides a versatile way to test web applications, debug APIs, and automate HTTP interactions directly from the command line without requiring a browser.

-----

### Basic cURL Syntax

Understanding the fundamental structure of cURL commands.

#### Command Structure

```bash
curl [options] [URL]
```

* **When to use:** For making any type of HTTP request.
* **Options:** Use flags to specify method, headers, data, and other parameters.

-----

### HTTP Methods with cURL

Different HTTP methods and how to use them with cURL.

#### GET Request - Retrieve Data

```bash
curl https://api.example.com/users
```

* **When to use:** When you need to fetch data from an endpoint.
* **Response:** Returns the response body from the server.

#### GET with Parameters

```bash
curl "https://api.example.com/users?name=john&age=30"
```

* **When to use:** When you need to send query parameters.
* **Note:** Enclose URL in quotes when using special characters.

#### POST Request - Send Form Data

```bash
curl -X POST https://api.example.com/users \
  -d "name=john" \
  -d "email=john@example.com"
```

* **When to use:** When submitting form data or creating resources.
* **Content-Type:** Defaults to `application/x-www-form-urlencoded`.

#### POST with JSON Data

```bash
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d '{"name": "john", "email": "john@example.com"}'
```

* **When to use:** When working with JSON APIs.
* **Headers:** Use `-H` to set Content-Type.

#### POST with File Upload

```bash
curl -X POST https://api.example.com/upload \
  -F "file=@document.pdf" \
  -F "description=Project document"
```

* **When to use:** When uploading files or multipart form data.
* **Content-Type:** Automatically sets to `multipart/form-data`.

#### PUT Request - Update Resources

```bash
curl -X PUT https://api.example.com/users/123 \
  -H "Content-Type: application/json" \
  -d '{"name": "john_doe", "email": "john.doe@example.com"}'
```

* **When to use:** When updating entire resources.
* **Idempotent:** Multiple identical requests have the same effect.

#### PATCH Request - Partial Update

```bash
curl -X PATCH https://api.example.com/users/123 \
  -H "Content-Type: application/json" \
  -d '{"email": "new.email@example.com"}'
```

* **When to use:** When updating specific fields of a resource.

#### DELETE Request - Remove Resources

```bash
curl -X DELETE https://api.example.com/users/123
```

* **When to use:** When deleting resources from the server.

#### HEAD Request - Headers Only

```bash
curl -I https://api.example.com/users
```

* **When to use:** When you only need response headers without the body.

-----

### Advanced cURL Options

Advanced features and options for specialized use cases.

#### Setting Custom Headers

```bash
curl -H "Authorization: Bearer token123" \
  -H "User-Agent: MyApp/1.0" \
  https://api.example.com/protected
```

* **When to use:** When authentication or custom headers are required.

#### Viewing Response Headers

```bash
curl -i https://api.example.com/users
```

* **When to use:** When you need both headers and body in the response.

#### Basic Authentication

```bash
curl -u username:password https://api.example.com/protected
```

* **When to use:** When HTTP Basic Auth is required.

#### Bearer Token Authentication

```bash
curl -H "Authorization: Bearer your_token_here" \
  https://api.example.com/protected
```

* **When to use:** When JWT or OAuth tokens are used.

#### Reading Data from File

```bash
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d @data.json
```

* **When to use:** When request body is stored in a file.

#### Saving Response to File

```bash
curl -o response.json https://api.example.com/users
```

* **When to use:** When you need to save the response to a file.

#### Following Redirects

```bash
curl -L https://example.com
```

* **When to use:** When the server returns redirect responses (3xx).

#### Setting Timeouts

```bash
curl --connect-timeout 10 --max-time 30 https://api.example.com/data
```

* **When to use:** To prevent hanging requests.

#### Verbose Output

```bash
curl -v https://api.example.com/users
```

* **When to use:** For debugging and seeing request/response details.

#### Ignoring SSL Certificate Verification

```bash
curl -k https://self-signed-cert.example.com
```

* **When to use:** For testing with self-signed certificates (not recommended for production).

-----

### Practical Examples

Real-world scenarios and use cases for cURL.

#### Testing File Upload Vulnerability

```bash
curl -X POST http://vulnerable-site.com/upload \
  -F "file=@shell.php" \
  -F "submit=Upload" \
  -H "Content-Type: multipart/form-data"
```

* **When to use:** Testing file upload functionality during security assessments.

#### API Testing Sequence

```bash
# Create user
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d '{"name": "alice", "email": "alice@example.com"}'

# Get user
curl https://api.example.com/users/1

# Update user
curl -X PUT https://api.example.com/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "alice_smith", "email": "alice.smith@example.com"}'

# Delete user
curl -X DELETE https://api.example.com/users/1
```

* **When to use:** Comprehensive API testing workflow.

#### Downloading Files

```bash
# Download and save with original name
curl -O https://example.com/files/document.pdf

# Download and save with custom name
curl -o myfile.pdf https://example.com/files/document.pdf
```

* **When to use:** When downloading files from web servers.

#### Session Management with Cookies

```bash
# Save cookies from login
curl -c cookies.txt -X POST https://example.com/login \
  -d "username=admin&password=secret"

# Use cookies for authenticated request
curl -b cookies.txt https://example.com/dashboard
```

* **When to use:** When maintaining session state across multiple requests.

-----

### Common cURL Flags Reference

Quick reference for frequently used cURL options.

| Flag | Description | Example |
| :--- | :--- | :--- |
| `-X` | HTTP method | `-X POST` |
| `-H` | Header | `-H "Content-Type: application/json"` |
| `-d` | Data (body) | `-d '{"key": "value"}'` |
| `-F` | Form data | `-F "file=@test.jpg"` |
| `-u` | Authentication | `-u user:pass` |
| `-i` | Include headers | `-i` |
| `-I` | Head only | `-I` |
| `-L` | Follow redirects | `-L` |
| `-o` | Output to file | `-o response.json` |
| `-O` | Save with remote name | `-O` |
| `-v` | Verbose | `-v` |
| `-k` | Ignore SSL | `-k` |
| `--connect-timeout` | Connection timeout | `--connect-timeout 10` |
| `--max-time` | Maximum time | `--max-time 30` |
| `-c` | Save cookies | `-c cookies.txt` |
| `-b` | Send cookies | `-b cookies.txt` |

-----

### Security Testing with cURL

Using cURL for security assessment and vulnerability testing.

#### Testing for SQL Injection

```bash
curl -X POST https://vulnerable-site.com/login \
  -d "username=admin' OR '1'='1'--&password=anything"
```

* **When to use:** Testing input validation vulnerabilities.

#### Testing for XSS

```bash
curl -X POST https://vulnerable-site.com/search \
  -d "query=<script>alert('XSS')</script>"
```

* **When to use:** Testing for cross-site scripting vulnerabilities.

#### Testing File Inclusion

```bash
curl https://vulnerable-site.com/index.php?page=../../etc/passwd
```

* **When to use:** Testing for local file inclusion vulnerabilities.

-----

### Automation Scripts

Script examples for automating cURL operations.

#### Bash Script for API Testing

```bash
#!/bin/bash

BASE_URL="https://api.example.com"
AUTH_TOKEN="bearer_token_here"

# Function to make authenticated request
api_request() {
    local method=$1
    local endpoint=$2
    local data=$3
    
    curl -X "$method" \
        -H "Authorization: Bearer $AUTH_TOKEN" \
        -H "Content-Type: application/json" \
        -d "$data" \
        "$BASE_URL$endpoint"
}

# Test endpoints
api_request "GET" "/users"
api_request "POST" "/users" '{"name": "test", "email": "test@example.com"}'
```

* **Why it's useful:** For automated API testing and integration.
* **How it works:** Wraps cURL commands in reusable functions.

#### Monitoring Script

```bash
#!/bin/bash

URLS=(
    "https://api.example.com/health"
    "https://web.example.com"
    "https://db.example.com/ping"
)

for url in "${URLS[@]}"; do
    if curl -s --head --fail "$url" > /dev/null; then
        echo "✓ $url is UP"
    else
        echo "✗ $url is DOWN"
    fi
done
```

* **Why it's useful:** For monitoring website and API availability.
* **How it works:** Checks HTTP response codes for multiple URLs.

-----

### Real-World Use Cases

Practical applications of cURL in various scenarios.

#### CI/CD Integration

```bash
# Deploy script using cURL
curl -X POST https://api.github.com/repos/owner/repo/deployments \
  -H "Authorization: token $GITHUB_TOKEN" \
  -H "Accept: application/vnd.github.ant-man-preview+json" \
  -d '{"ref": "main", "environment": "production"}'
```

* **Why it's used:** For automating deployment pipelines and integrations.

#### Webhook Testing

```bash
curl -X POST https://api.example.com/webhook \
  -H "Content-Type: application/json" \
  -H "X-GitHub-Event: push" \
  -d '{"ref": "refs/heads/main", "commits": [{"id": "abc123", "message": "Test commit"}]}'
```

* **Why it's used:** For testing webhook endpoints and integrations.

#### Load Testing Preparation

```bash
# Generate test data
for i in {1..100}; do
    curl -X POST https://api.example.com/users \
      -H "Content-Type: application/json" \
      -d "{\"name\": \"user$i\", \"email\": \"user$i@example.com\"}"
done
```

* **Why it's used:** For preparing test data before load testing.

-----

### Advanced Authentication Methods

Beyond basic auth, cURL supports various authentication mechanisms used in modern APIs.

#### OAuth 2.0 Authentication

```bash
# Get access token
TOKEN=$(curl -X POST https://auth.example.com/oauth/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=client_credentials&client_id=your_id&client_secret=your_secret" \
  | jq -r '.access_token')

# Use token in requests
curl -H "Authorization: Bearer $TOKEN" https://api.example.com/data
```

* **When to use:** When APIs require OAuth 2.0 authentication.
* **How it works:** Obtains access token and uses it in subsequent requests.

#### API Key Authentication

```bash
curl -H "X-API-Key: your_api_key_here" https://api.example.com/data
curl "https://api.example.com/data?api_key=your_api_key_here"
```

* **When to use:** When services use API keys for authentication.
* **Header vs Query:** Header is more secure than query parameter.

#### JWT Token Handling

```bash
# Decode JWT (without verification)
curl -s "https://jwt.io/?jwt=your.jwt.token.here" | grep -o '"payload":"[^"]*"' | cut -d'"' -f4 | base64 -d

# Use JWT in requests
curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." https://api.example.com/protected
```

* **When to use:** Working with JSON Web Tokens.
* **Security Note:** Never expose JWT secrets in logs or version control.

#### Certificate-Based Authentication

```bash
curl --cert client.crt --key client.key https://api.example.com/secure
curl --cacert ca.crt https://api.example.com/secure
```

* **When to use:** When mutual TLS authentication is required.
* **Certificate Types:** Client certificate for authentication, CA cert for verification.

#### Digest Authentication

```bash
curl --digest -u username:password https://secure.example.com/protected
```

* **When to use:** When servers require HTTP Digest authentication.
* **Security:** More secure than Basic auth as password is not sent in plain text.

#### NTLM Authentication

```bash
curl --ntlm -u domain\\username:password https://windows.example.com/api
```

* **When to use:** For Windows-based authentication systems.
* **Compatibility:** Works with Active Directory environments.

-----

### Proxy and Network Configuration

Using cURL through proxies and configuring network settings for various scenarios.

#### HTTP Proxy

```bash
curl --proxy http://proxy.example.com:8080 https://target.com
curl --proxy-user user:pass --proxy http://proxy.example.com:8080 https://target.com
```

* **When to use:** When routing traffic through HTTP proxies.
* **Authentication:** Use --proxy-user for authenticated proxies.

#### SOCKS Proxy

```bash
curl --socks5 proxy.example.com:1080 https://target.com
curl --socks5-hostname proxy.example.com:1080 https://target.com
```

* **When to use:** For SOCKS5 proxy support, useful for anonymity.
* **DNS:** --socks5-hostname resolves DNS through proxy.

#### Proxy Auto-Configuration (PAC)

```bash
curl --proxy auto https://target.com
```

* **When to use:** When using system proxy settings.
* **Platform:** Works with system proxy configuration.

#### IPv4/IPv6 Specific Requests

```bash
curl --ipv4 https://dual-stack.example.com
curl --ipv6 https://dual-stack.example.com
curl --interface eth0 https://target.com
```

* **When to use:** For testing specific network interfaces or IP versions.
* **Troubleshooting:** Useful for network connectivity issues.

#### DNS Resolution Control

```bash
curl --resolve example.com:443:192.168.1.100 https://example.com
curl --dns-servers 8.8.8.8,8.8.4.4 https://example.com
```

* **When to use:** For testing with specific DNS servers or IP resolutions.
* **Load Balancing:** Test different backend servers.

#### Connection Reuse

```bash
curl -c cookies.txt -b cookies.txt --keepalive-time 30 https://api.example.com/endpoint1
curl -c cookies.txt -b cookies.txt --keepalive-time 30 https://api.example.com/endpoint2
```

* **When to use:** For multiple requests to the same host to improve performance.
* **Keep-Alive:** Maintains persistent connections.

-----

### Data Processing and Manipulation

Advanced techniques for handling different data formats and processing responses.

#### JSON Processing with jq

```bash
# Extract specific fields
curl -s https://api.example.com/users | jq '.users[].name'

# Filter and transform
curl -s https://api.example.com/data | jq '.items | map({id: .id, name: .name})'

# Pretty print
curl -s https://api.example.com/data | jq '.'
```

* **When to use:** For processing JSON responses in scripts.
* **Tool:** jq is a powerful JSON processor.

#### XML Processing

```bash
# Using xmllint
curl -s https://api.example.com/data.xml | xmllint --format -

# Extract with xpath
curl -s https://api.example.com/data.xml | xpath -q -e '//user/name/text()'
```

* **When to use:** When working with XML APIs.
* **Validation:** xmllint can validate XML structure.

#### CSV Data Handling

```bash
# Parse CSV response
curl -s https://api.example.com/data.csv | csvtool -t COMMA col 1 -

# Convert to JSON
curl -s https://api.example.com/data.csv | csvjson
```

* **When to use:** For CSV-based APIs or data exports.
* **Processing:** Use csvtool or csvkit for manipulation.

#### Binary Data and File Transfers

```bash
# Download binary file
curl -o image.jpg https://example.com/image.jpg

# Upload binary with proper headers
curl -X POST https://api.example.com/upload \
  -H "Content-Type: application/octet-stream" \
  --data-binary @file.bin
```

* **When to use:** For binary file uploads/downloads.
* **Headers:** Important for correct content type.

#### Streaming Data

```bash
# Stream response to stdout
curl -N https://streaming-api.example.com/events

# Limited streaming
curl --max-filesize 1000000 https://large-file.example.com/download
```

* **When to use:** For real-time data or large file handling.
* **Control:** Use --max-filesize to limit download size.

-----

### Error Handling and Debugging

Techniques for handling errors, debugging issues, and troubleshooting cURL requests.

#### Exit Codes and Error Handling

```bash
#!/bin/bash
if curl -f -s https://api.example.com/health > /dev/null; then
    echo "Service is healthy"
else
    echo "Service is down (exit code: $?)"
fi
```

* **When to use:** In scripts to handle different response scenarios.
* **Exit Codes:** cURL returns different codes for various error conditions.

#### Detailed Error Information

```bash
curl -w "@curl-format.txt" -o /dev/null -s https://api.example.com/test
```

* **curl-format.txt:**
```
     time_namelookup:  %{time_namelookup}\n
        time_connect:  %{time_connect}\n
     time_appconnect:  %{time_appconnect}\n
    time_pretransfer:  %{time_pretransfer}\n
       time_redirect:  %{time_redirect}\n
  time_starttransfer:  %{time_starttransfer}\n
                     ----------
          time_total:  %{time_total}\n
```

* **When to use:** For detailed timing and performance analysis.
* **Metrics:** Provides comprehensive request timing information.

#### SSL/TLS Debugging

```bash
curl -v --trace-ascii debug.log https://secure.example.com
curl --cert-status https://ocsp.example.com
```

* **When to use:** For debugging SSL certificate and connection issues.
* **OCSP:** --cert-status checks certificate revocation status.

#### Network Debugging

```bash
curl --trace-ascii network.log https://api.example.com/data
curl --libcurl code.c https://api.example.com/data  # Generate C code
```

* **When to use:** For low-level network debugging.
* **Code Generation:** --libcurl generates equivalent libcurl code.

#### Rate Limiting and Retries

```bash
# Retry on failure
curl --retry 3 --retry-delay 5 https://unreliable-api.example.com

# Rate limiting simulation
for i in {1..10}; do
    curl -s https://api.example.com/data > /dev/null
    sleep 1
done
```

* **When to use:** For handling unreliable services or implementing polite scraping.
* **Backoff:** --retry-delay implements exponential backoff.

-----

### Performance Testing and Load Simulation

Using cURL for performance testing and load simulation scenarios.

#### Concurrent Requests

```bash
# Using xargs for parallel requests
seq 1 100 | xargs -n1 -P10 curl -s https://api.example.com/test > /dev/null
```

* **When to use:** For basic load testing with concurrent requests.
* **Control:** -P flag controls parallelism level.

#### Load Testing Script

```bash
#!/bin/bash

URL="https://api.example.com/endpoint"
CONCURRENT=50
REQUESTS=1000

for i in $(seq 1 $CONCURRENT); do
    (
        for j in $(seq 1 $((REQUESTS/CONCURRENT))); do
            curl -s -w "%{time_total}\n" -o /dev/null "$URL"
        done
    ) &
done
wait
```

* **When to use:** For custom load testing scenarios.
* **Metrics:** Collect response times for analysis.

#### Benchmarking

```bash
curl -w "@benchmark-format.txt" -o /dev/null -s "$URL"
```

* **benchmark-format.txt:**
```
DNS Lookup: %{time_namelookup}
TCP Connect: %{time_connect}
SSL Handshake: %{time_appconnect}
Server Processing: %{time_starttransfer}
Total Time: %{time_total}
Download Speed: %{speed_download}
HTTP Code: %{http_code}
```

* **When to use:** For detailed performance benchmarking.
* **Analysis:** Provides comprehensive timing breakdown.

#### Stress Testing

```bash
# Flood with requests
while true; do
    curl -s https://api.example.com/stress-test > /dev/null &
done
```

* **When to use:** For stress testing server limits (use carefully).
* **Warning:** Can overwhelm servers, use responsibly.

#### Memory and CPU Usage Testing

```bash
# Large response handling
curl -s "https://api.example.com/large-dataset" | wc -c

# Memory-intensive operations
curl -s https://api.example.com/data | jq '.large_array | length'
```

* **When to use:** Testing resource usage with large datasets.
* **Monitoring:** Use system tools to monitor resource consumption.

-----

### Integration with Other Tools

Combining cURL with other command-line tools for enhanced functionality.

#### Integration with awk and sed

```bash
# Extract specific data with awk
curl -s https://api.example.com/users | jq -r '.users[] | @csv' | awk -F, '$3 == "admin" {print $1}'

# Text processing with sed
curl -s https://api.example.com/logs | sed -n '/ERROR/p'
```

* **When to use:** For complex data extraction and processing.
* **Pipeline:** Combine multiple tools for powerful data manipulation.

#### Database Integration

```bash
# Insert API data into database
curl -s https://api.example.com/users | jq -r '.[] | @csv' | sqlite3 users.db ".import /dev/stdin users"

# Query and use in API calls
sqlite3 users.db "SELECT id FROM users WHERE active=1" | xargs -I {} curl -s https://api.example.com/user/{}/data
```

* **When to use:** For ETL operations and data synchronization.
* **Workflow:** Extract from API, transform, load into database.

#### Version Control Integration

```bash
# API testing in CI/CD
curl -f https://api.example.com/health || exit 1

# Deploy with API call
curl -X POST https://deploy.example.com \
  -H "Authorization: Bearer $DEPLOY_TOKEN" \
  -d "{\"branch\": \"$GIT_BRANCH\", \"commit\": \"$GIT_COMMIT\"}"
```

* **When to use:** In deployment pipelines and CI/CD workflows.
* **Automation:** Automate deployment and testing processes.

#### Monitoring Integration

```bash
# Send metrics to monitoring system
RESPONSE_TIME=$(curl -w "%{time_total}" -o /dev/null -s https://api.example.com)
curl -X POST https://monitoring.example.com/metrics \
  -d "metric=api_response_time&value=$RESPONSE_TIME&timestamp=$(date +%s)"
```

* **When to use:** For integrating with monitoring and alerting systems.
* **Metrics:** Collect and forward performance metrics.

-----

### Advanced Security Testing Scenarios

Using cURL for comprehensive security assessment and penetration testing.

#### SSRF (Server-Side Request Forgery) Testing

```bash
# Test internal network access
curl "https://vulnerable-site.com/proxy?url=http://internal-server.local/admin"

# Test cloud metadata access
curl "https://vulnerable-site.com/fetch?url=http://169.254.169.254/latest/meta-data/"

# Test localhost access
curl "https://vulnerable-site.com/api?url=http://127.0.0.1:22"
```

* **When to use:** Testing for SSRF vulnerabilities in web applications.
* **Targets:** Internal services, cloud metadata, localhost services.

#### CSRF (Cross-Site Request Forgery) Testing

```bash
# Test CSRF protection bypass
curl -X POST https://vulnerable-site.com/change-password \
  -H "Cookie: session=attacker_session" \
  -d "new_password=hacked&confirm_password=hacked"

# Test with custom origin
curl -X POST https://vulnerable-site.com/action \
  -H "Origin: https://evil.com" \
  -H "Referer: https://evil.com/csrf.html" \
  -d "action=delete_user&id=123"
```

* **When to use:** Testing CSRF protections and token validation.
* **Headers:** Manipulate Origin and Referer headers.

#### IDOR (Insecure Direct Object Reference) Testing

```bash
# Test parameter manipulation
curl -H "Authorization: Bearer $USER_TOKEN" https://api.example.com/user/123
curl -H "Authorization: Bearer $USER_TOKEN" https://api.example.com/user/124
curl -H "Authorization: Bearer $USER_TOKEN" https://api.example.com/user/1

# Test with encoded IDs
curl https://api.example.com/document/$(echo -n "admin_doc" | base64)
```

* **When to use:** Testing for IDOR vulnerabilities in APIs.
* **Enumeration:** Try different IDs and encoded values.

#### Race Condition Testing

```bash
# Concurrent requests for race conditions
for i in {1..10}; do
    curl -X POST https://api.example.com/transfer \
      -H "Authorization: Bearer $TOKEN" \
      -d "from_account=123&to_account=456&amount=100" &
done
wait
```

* **When to use:** Testing for race conditions in financial or resource operations.
* **Concurrency:** Send multiple simultaneous requests.

#### HTTP Request Smuggling Testing

```bash
# CL.TE smuggling
curl -X POST https://vulnerable-site.com/ \
  -H "Content-Length: 5" \
  -H "Transfer-Encoding: chunked" \
  -d "0\r\n\r\nGET /admin HTTP/1.1\r\nHost: vulnerable-site.com\r\n\r\n"

# TE.CL smuggling
curl -X POST https://vulnerable-site.com/ \
  -H "Transfer-Encoding: chunked" \
  -H "Content-Length: 4" \
  -d "1\r\nA\r\n0\r\n\r\n"
```

* **When to use:** Testing for HTTP request smuggling vulnerabilities.
* **Techniques:** Manipulate Content-Length and Transfer-Encoding headers.

#### Host Header Injection Testing

```bash
# Basic host header injection
curl -H "Host: evil.com" https://vulnerable-site.com/

# Host header with port
curl -H "Host: evil.com:8080" https://vulnerable-site.com/

# Multiple host headers
curl -H "Host: vulnerable-site.com" -H "Host: evil.com" https://vulnerable-site.com/
```

* **When to use:** Testing for host header injection vulnerabilities.
* **Impact:** Can lead to cache poisoning, SSRF, etc.

-----

### cURL in Different Environments

Adapting cURL usage for different operating systems and environments.

#### Windows cURL Usage

```cmd
REM Basic GET request
curl.exe https://api.example.com/data

REM POST with data
curl.exe -X POST https://api.example.com/users -d "name=john"

REM With authentication
curl.exe -u username:password https://secure.example.com/api
```

* **When to use:** Running cURL on Windows systems.
* **Installation:** Usually comes with Git for Windows or can be downloaded separately.

#### PowerShell Integration

```powershell
# Using curl alias
curl.exe -Uri https://api.example.com/data

# Invoke-WebRequest alternative
Invoke-WebRequest -Uri https://api.example.com/data -Method GET

# Convert to PowerShell objects
(Invoke-WebRequest -Uri https://api.example.com/users).Content | ConvertFrom-Json
```

* **When to use:** When working in PowerShell environments.
* **Native Cmdlets:** PowerShell has built-in web request capabilities.

#### macOS Specific Features

```bash
# Using Homebrew installed curl
/usr/local/bin/curl --version

# With keychain integration
curl --cert-status https://api.example.com/secure
```

* **When to use:** On macOS systems with specific requirements.
* **Security:** macOS has built-in certificate validation.

#### Linux Container Environments

```bash
# In Docker container
curl --dns-servers 8.8.8.8 https://api.example.com

# With Alpine Linux
apk add curl ca-certificates
curl https://api.example.com/data
```

* **When to use:** When working with containerized applications.
* **DNS:** Sometimes need to specify DNS servers in containers.

#### Embedded Systems

```bash
# BusyBox curl
busybox curl https://api.example.com/status

# Minimal curl options
curl -s -f https://health-check.example.com
```

* **When to use:** On embedded systems with limited resources.
* **BusyBox:** Many embedded systems use BusyBox version of curl.

-----

### Troubleshooting Common Issues

Solutions for frequently encountered cURL problems and errors.

#### SSL Certificate Errors

```bash
# Skip verification (not recommended for production)
curl -k https://self-signed.example.com

# Specify CA certificate
curl --cacert /path/to/ca.crt https://api.example.com

# Update CA certificates
curl --capath /etc/ssl/certs https://api.example.com
```

* **When to use:** When encountering SSL/TLS certificate validation errors.
* **Security:** Only use -k for testing, never in production.

#### Connection Timeouts

```bash
# Increase timeout
curl --connect-timeout 30 --max-time 300 https://slow-api.example.com

# Retry on timeout
curl --retry 3 --retry-delay 5 https://unreliable-api.example.com
```

* **When to use:** When requests are timing out.
* **Configuration:** Adjust timeout values based on network conditions.

#### DNS Resolution Issues

```bash
# Specify DNS server
curl --dns-servers 8.8.8.8,1.1.1.1 https://api.example.com

# Force IPv4/IPv6
curl --ipv4 https://dual-stack.example.com
curl --ipv6 https://dual-stack.example.com
```

* **When to use:** When DNS resolution is failing.
* **Diagnosis:** Test with different DNS servers.

#### Proxy Configuration Problems

```bash
# Test proxy connectivity
curl --proxy http://proxy.example.com:8080 --proxy-user user:pass https://httpbin.org/ip

# Bypass proxy for local addresses
curl --noproxy localhost,127.0.0.1 https://local-api.example.com
```

* **When to use:** When having issues with proxy configurations.
* **Testing:** Use httpbin.org for proxy testing.

#### Character Encoding Issues

```bash
# Handle UTF-8 responses
curl -s https://api.example.com | iconv -f utf-8 -t utf-8

# URL encode data
curl -X POST https://api.example.com \
  --data-urlencode "message=Hello World! 你好"
```

* **When to use:** When dealing with international characters or encoding problems.
* **Tools:** Use iconv for character set conversion.

#### Large File Download Issues

```bash
# Resume interrupted download
curl -C - -O https://large-file.example.com/file.zip

# Limit download size
curl --max-filesize 1000000 https://api.example.com/large-file
```

* **When to use:** For large file transfers or bandwidth-limited environments.
* **Resume:** -C - automatically resumes from where it left off.

-----

### Advanced Scripting Techniques

Complex scripting patterns using cURL for automation and testing.

#### API Testing Framework

```bash
#!/bin/bash

API_BASE="https://api.example.com"
AUTH_TOKEN=""

login() {
    local response=$(curl -s -X POST "$API_BASE/login" \
        -H "Content-Type: application/json" \
        -d '{"username":"test","password":"test"}')
    
    AUTH_TOKEN=$(echo $response | jq -r '.token')
}

api_call() {
    local method=$1
    local endpoint=$2
    local data=$3
    
    curl -s -X "$method" \
        -H "Authorization: Bearer $AUTH_TOKEN" \
        -H "Content-Type: application/json" \
        -d "$data" \
        "$API_BASE$endpoint"
}

# Usage
login
api_call "GET" "/users"
api_call "POST" "/users" '{"name":"new_user"}'
```

* **When to use:** For building comprehensive API testing frameworks.
* **Modularity:** Separate authentication and API calls.

#### Load Testing with Progress Tracking

```bash
#!/bin/bash

URL="https://api.example.com/test"
TOTAL_REQUESTS=1000
CONCURRENT=10

progress_bar() {
    local current=$1
    local total=$2
    local width=50
    local percentage=$((current * 100 / total))
    local completed=$((current * width / total))
    
    printf "\rProgress: [%-${width}s] %d%% (%d/%d)" \
        "$(printf '%.0s=' $(seq 1 $completed))" \
        $percentage $current $total
}

export -f progress_bar

seq 1 $TOTAL_REQUESTS | xargs -n1 -P$CONCURRENT bash -c '
    curl -s -w "%{http_code}\n" -o /dev/null "$1" > /tmp/curl_result_$2
    progress_bar $2 '$TOTAL_REQUESTS'
' _ "$URL"

echo -e "\nLoad test completed."
```

* **When to use:** For advanced load testing with progress visualization.
* **Parallelism:** Uses xargs for concurrent execution.

#### Response Validation Script

```bash
#!/bin/bash

URL="https://api.example.com/health"
EXPECTED_STATUS=200
EXPECTED_RESPONSE="healthy"

response=$(curl -s -w "HTTPSTATUS:%{http_code}" "$URL")
http_code=$(echo $response | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
body=$(echo $response | sed -e 's/HTTPSTATUS:.*//g')

if [ "$http_code" -eq "$EXPECTED_STATUS" ] && echo "$body" | grep -q "$EXPECTED_RESPONSE"; then
    echo "✓ Health check passed"
    exit 0
else
    echo "✗ Health check failed"
    echo "Expected: $EXPECTED_STATUS, Got: $http_code"
    echo "Response: $body"
    exit 1
fi
```

* **When to use:** For automated health checks and response validation.
* **CI/CD:** Perfect for deployment pipelines.

#### Multi-Environment Testing

```bash
#!/bin/bash

declare -A environments=(
    ["dev"]="https://dev-api.example.com"
    ["staging"]="https://staging-api.example.com"
    ["prod"]="https://api.example.com"
)

test_endpoint() {
    local env=$1
    local url=$2
    local endpoint=$3
    
    echo "Testing $env environment..."
    response=$(curl -s -w "HTTPSTATUS:%{http_code};TIME:%{time_total}" "$url$endpoint")
    
    http_code=$(echo $response | grep -o 'HTTPSTATUS:[0-9]*' | cut -d: -f2)
    time=$(echo $response | grep -o 'TIME:[0-9.]*' | cut -d: -f2)
    
    if [ "$http_code" -eq 200 ]; then
        echo "✓ $env: OK (${time}s)"
    else
        echo "✗ $env: FAILED (HTTP $http_code)"
    fi
}

for env in "${!environments[@]}"; do
    test_endpoint "$env" "${environments[$env]}" "/health"
done
```

* **When to use:** For testing across multiple deployment environments.
* **Automation:** Easily extensible for different endpoints.

-----

### cURL with Other Protocols

Using cURL for protocols beyond HTTP/HTTPS.

#### FTP Operations

```bash
# List FTP directory
curl ftp://ftp.example.com/

# Download file
curl -O ftp://ftp.example.com/file.txt

# Upload file
curl -T localfile.txt ftp://ftp.example.com/

# FTP with authentication
curl -u username:password ftp://ftp.example.com/
```

* **When to use:** For FTP server interactions.
* **Security:** FTP is insecure, use FTPS when possible.

#### FTPS (FTP over SSL)

```bash
# Implicit FTPS
curl ftps://ftp.example.com/

# Explicit FTPS
curl --ftp-ssl ftp://ftp.example.com/
```

* **When to use:** For secure FTP operations.
* **Certificates:** May require certificate validation.

#### SCP/SFTP

```bash
# SCP upload
curl -T localfile.txt scp://user@host:/path/

# SFTP download
curl -u user:password sftp://host/path/file.txt
```

* **When to use:** For secure file transfers over SSH.
* **Keys:** Can use SSH keys with --key and --pubkey options.

#### LDAP

```bash
# LDAP search
curl ldap://ldap.example.com/dc=example,dc=com?cn?sub?(uid=john)

# LDAPS (LDAP over SSL)
curl ldaps://ldap.example.com/dc=example,dc=com
```

* **When to use:** For directory service queries.
* **Filters:** Support for LDAP search filters.

#### DICT (Dictionary Protocol)

```bash
# Dictionary lookup
curl dict://dict.org/d:word

# List databases
curl dict://dict.org/show:db
```

* **When to use:** For dictionary and thesaurus lookups.
* **Protocol:** Uses the DICT protocol.

#### TELNET

```bash
# Basic telnet connection
curl telnet://host:23

# With input
echo "GET / HTTP/1.0\nHost: example.com\n\n" | curl telnet://example.com:80
```

* **When to use:** For interactive text-based protocols.
* **Limitations:** Not suitable for binary protocols.

-----

### Performance Optimization

Techniques for optimizing cURL performance and resource usage.

#### Connection Reuse

```bash
# Keep connections alive
curl -H "Connection: keep-alive" --keepalive-time 30 https://api.example.com/endpoint1
curl -H "Connection: keep-alive" --keepalive-time 30 https://api.example.com/endpoint2
```

* **When to use:** For multiple requests to the same host.
* **Efficiency:** Reduces connection overhead.

#### HTTP/2 Support

```bash
# Force HTTP/2
curl --http2 https://http2.example.com

# Check protocol version
curl -I --http2 https://example.com | grep -i protocol
```

* **When to use:** When server supports HTTP/2 for better performance.
* **Multiplexing:** Allows multiple concurrent streams.

#### Compression

```bash
# Request compressed response
curl -H "Accept-Encoding: gzip,deflate" https://api.example.com/data

# Automatic decompression
curl --compressed https://api.example.com/data
```

* **When to use:** To reduce bandwidth usage.
* **Formats:** Supports gzip, deflate, br (Brotli).

#### Parallel Downloads

```bash
# Download multiple files in parallel
curl -Z -O https://example.com/file1.jpg -O https://example.com/file2.jpg

# With custom names
curl -Z -o file1.jpg https://example.com/file1.jpg -o file2.jpg https://example.com/file2.jpg
```

* **When to use:** For downloading multiple files efficiently.
* **Parallelism:** -Z enables parallel transfers.

#### Bandwidth Limiting

```bash
# Limit download speed
curl --limit-rate 100k https://large-file.example.com/download

# Limit upload speed
curl --limit-rate 50k -T largefile.zip ftp://ftp.example.com/
```

* **When to use:** To control bandwidth usage.
* **Units:** Supports k, m, g suffixes.

-----

### Custom cURL Configurations

Creating and using configuration files for complex scenarios.

#### cURL Configuration File

```bash
# .curlrc file
user-agent = "MyApp/1.0"
connect-timeout = 10
max-time = 30
compressed
silent
show-error
```

* **When to use:** For setting default options.
* **Location:** ~/.curlrc or specified with -K.

#### Environment Variables

```bash
export CURL_CA_BUNDLE=/path/to/ca-bundle.crt
export http_proxy=http://proxy.example.com:8080
export https_proxy=http://proxy.example.com:8080
export no_proxy=localhost,127.0.0.1
```

* **When to use:** For system-wide proxy and certificate settings.
* **Override:** Command-line options override environment variables.

#### Aliases and Functions

```bash
# Bash alias for API testing
alias api-get='curl -H "Authorization: Bearer $API_TOKEN" -H "Content-Type: application/json"'
alias api-post='curl -X POST -H "Authorization: Bearer $API_TOKEN" -H "Content-Type: application/json"'

# Usage
api-get https://api.example.com/users
api-post https://api.example.com/users -d '{"name":"test"}'
```

* **When to use:** For frequently used cURL commands.
* **Customization:** Easy to modify and extend.

-----

**Made with love by VIsh0k**
