### âš¡ PHP Command Execution and Shell Functions

**PHP Command Execution Functions** allow developers to execute system commands, interact with the shell, or run external programs from within PHP scripts. These functions can be powerful but extremely dangerous if misused, as they can lead to remote code execution (RCE), privilege escalation, or system compromise. Many are disabled by default in secure configurations via `disable_functions` in `php.ini`.

  * **Key Concepts**
  * **Shell Execution:** Functions that run commands via the system shell.
  * **Process Management:** Functions for opening, monitoring, and controlling processes.
  * **Code Evaluation:** Functions that can execute arbitrary PHP code.
  * **Security Risks:** Always sanitize inputs, use least privilege, and avoid these in user-facing code.

-----

### ðŸ›¡ï¸ Core Shell Escaping Functions

  * **`escapeshellarg` - Escape a string to be used as a shell argument**

    ```php
    $arg = "file with spaces.txt";
    $escaped = escapeshellarg($arg);
    echo $escaped; # Output: 'file with spaces.txt'
    ```

    **Why it's used:** Prevents injection when passing user input to shell commands.
    **How it works:** Escapes a string to make it safe for use as a command-line argument. It wraps the string in single quotes and escapes any existing single quotes.

  * **`escapeshellcmd` - Escape shell metacharacters**

    ```php
    $cmd = "ls | grep file";
    $escaped = escapeshellcmd($cmd);
    echo $escaped; # Output: ls \| grep file
    ```

    **Why it's used:** Sanitize commands before execution.
    **How it works:** Escapes shell metacharacters in a command string. This helps prevent command injection by neutralizing special characters like `;`, `|`, `&`, etc.

-----

### ðŸš€ Command Execution Functions

  * **`exec` - Execute an external program**

    ```php
    $output = [];
    $return_var = 0;
    exec('ls -la', $output, $return_var);
    print_r($output); # Array of output lines
    echo "Exit code: $return_var\n";
    ```

    **Why it's used:** Run system commands and capture results.
    **How it works:** Executes an external program and returns the last line of output. Can capture full output in an array and return the exit code.

  * **`passthru` - Execute an external program and display raw output**

    ```php
    passthru('ls -la'); # Outputs directly
    ```

    **Why it's used:** Streaming output or handling binaries.
    **How it works:** Executes a command and passes the raw output directly to the browser or stdout, including binary data.

  * **`shell_exec` - Execute command via shell and return the complete output as a string**

    ```php
    $output = shell_exec('ls -la');
    echo $output;
    ```

    **Why it's used:** Capture command output in a variable.
    **How it works:** Executes a command via the shell and returns the full output as a string. Equivalent to backticks.

  * **`system` - Execute an external program and display the output**

    ```php
    system('ls -la', $return_var);
    echo "Exit code: $return_var\n";
    ```

    **Why it's used:** Direct output display.
    **How it works:** Executes a command and outputs the result directly, optionally capturing the exit code.

-----

### âš™ï¸ Advanced Process Control

  * **`proc_open` - Execute a command and open file pointers for input/output**

    ```php
    $descriptorspec = [
        0 => ['pipe', 'r'], # stdin
        1 => ['pipe', 'w'], # stdout
        2 => ['pipe', 'w']  # stderr
    ];

    $process = proc_open('echo "Hello"', $descriptorspec, $pipes);

    if (is_resource($process)) {
        echo stream_get_contents($pipes[1]); # Read output
        fclose($pipes[1]);
        proc_close($process);
    }
    ```

    **Why it's used:** Advanced process control with I/O.
    **How it works:** Opens a process with pipes for stdin, stdout, and stderr, allowing bidirectional communication.

  * **`proc_close` - Close a process opened by proc_open and return the exit code**

    ```php
    $exit_code = proc_close($process);
    echo "Exit code: $exit_code\n";
    ```

    **Why it's used:** Clean up after process execution.
    **How it works:** Closes a process resource and returns the exit code of the executed command.

  * **`proc_get_status` - Get information about a process opened by proc_open**

    ```php
    $status = proc_get_status($process);
    print_r($status); # Array with 'running', 'pid', etc.
    ```

    **Why it's used:** Monitor process state.
    **How it works:** Returns an array with status information about a running process, including PID, running state, and exit code.

  * **`proc_terminate` - Kills a process opened by proc_open**

    ```php
    proc_terminate($process); # Kill the process
    ```

    **Why it's used:** Force stop long-running processes.
    **How it works:** Terminates a running process.

  * **`proc_nice` - Change the priority of the current process**

    ```php
    proc_nice(10); # Increase nice value (lower priority)
    ```

    **Why it's used:** Adjust process scheduling.
    **How it works:** Changes the priority of the current process. Lower values mean higher priority.

-----

### ðŸ’€ Dangerous Code Execution Functions

  * **`eval` - Evaluate a string as PHP code**

    ```php
    $code = 'echo "Hello";';
    eval($code); # Executes the code
    ```

    **Why it's used:** Execute dynamic PHP code.
    **How it works:** Executes arbitrary PHP code from a string. Extremely dangerous.

  * **`assert` - Checks if assertion is false (can execute code)**

    ```php
    assert('system("whoami")'); # Executes command
    ```

    **Why it's used:** Debugging and testing.
    **How it works:** In older PHP versions, if passed a string, it evaluates it as code.

  * **`create_function` - Create an anonymous function**

    ```php
    $func = create_function('', 'echo "Hello";');
    $func();
    ```

    **Why it's used:** Dynamic function creation.
    **How it works:** Creates a function from a string. Deprecated but can execute code.

  * **`preg_replace` with `/e` modifier - Execute code in replacement**

    ```php
    # Old PHP: preg_replace('/pattern/e', 'system("cmd")', $string);
    ```
    **Why it's used:** Pattern replacement with code execution.
    **How it works:** Deprecated in PHP 7+. Executes code in the replacement string.

-----

### ðŸ”¥ Additional Dangerous Patterns

  * **`include/require` with user input - Remote code execution**

    ```php
    include($_GET['file']); # Dangerous
    ```

    **Why it's used:** Dynamic file inclusion.
    **How it works:** Including files from user input can execute remote code.

  * **`file_get_contents` with wrappers**

    ```php
    file_get_contents('data:#text/plain;base64,ZXhpdCgnSGFja2VkJyk7');
    ```

    **Why it's used:** Reading data from various sources.
    **How it works:** Can execute code via `data:#` or `php:#` wrappers.

  * **`call_user_func` and `call_user_func_array`**

    ```php
    call_user_func('system', 'whoami');
    ```

    **Why it's used:** Dynamic function calling.
    **How it works:** Call functions dynamically, including dangerous ones.

  * **`ReflectionFunction` invoke**

    ```php
    $func = new ReflectionFunction('system');
    $func->invoke('whoami');
    ```

    **Why it's used:** Advanced function invocation.
    **How it works:** Use reflection to invoke functions.

  * **`unserialize` with POP chains**

    ```php
    unserialize($malicious_payload); # Can trigger RCE
    ```

    **Why it's used:** Object serialization/deserialization.
    **How it works:** Deserializing crafted payloads can execute code via object methods.

  * **`pcntl_exec` - Execute program (requires pcntl extension)**

    ```php
    pcntl_exec('/bin/ls', ['-la']);
    ```

    **Why it's used:** Process replacement.
    **How it works:** Replaces the current process with a new program.

  * **`posix_kill` - Send signal to process**

    ```php
    posix_kill($pid, SIGTERM);
    ```

    **Why it's used:** Process management.
    **How it works:** Sends signals to processes, can terminate or control them.

  * **`dl` - Load extension dynamically**

    ```php
    dl('evil.so'); # Dangerous
    ```

    **Why it's used:** Runtime extension loading.
    **How it works:** Loads PHP extensions at runtime.

-----

**Made with love by VIsh0k**